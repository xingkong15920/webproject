<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/font.css">
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    #iosiframe {
        height: 100%;
    }

    .x-body {
        height: calc(100% - 40px);
        box-sizing: border-box;
        overflow: auto;
    }

    .layui-fluid {
        padding: 0;
    }

    .ThirdBody {
        box-shadow: 0 0 20px 0 rgba(0, 0, 0, .2);
        border-radius: 4px;
        border-top: 1px solid #eee;
        border-left: 1px solid #eee;
    }

    .ThirdList {
        border-bottom: 1px solid #eee;
        border-right: 1px solid #eee;
        transition: all 0.35s;
        cursor: pointer;
    }

    .ThirdList:hover {
        box-shadow: 0 0 20px 0 rgba(0, 0, 0, .2);
        z-index: 5000;
    }

    .layui-card-body {
        height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .ThirdListB {
        display: flex;
        align-items: center;
        flex-direction: column;
    }

    .ThirdListB img {
        width: 100px;
        height: 100px;
    }

    .ThirdListB p {
        margin-bottom: 10px;
    }

    .layui-form .layui-card-body {
        height: 180px;
    }

    .layui-col-md1 {
        width: 160px !important;
    }
    </style>
</head>

<body id="iosiframe">
    <div class="x-nav">
        <span class="layui-breadcrumb">
            <a href="">机构</a>
            <a><cite>权限管理</cite></a>
        </span>
        <!-- <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
            <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a> -->
    </div>
    <div class="x-body">
        <!-- 第三方应用管理 -->
        <form class="layui-form" action="" lay-filter="cardAdd">
            <div class="layui-fluid" style="margin-bottom: 30px;">
                <blockquote class="layui-elem-quote" style="font-size: 20px;">通道权限</blockquote>
                <div class="layui-row layui-col-space1 ThirdBody">
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body" style="height:180px">
                                <div class="ThirdListB">
                                    <img src="../../public/images/pm-weixin.png" style="width:50px;height:50px;margin:25px">
                                    <p>官方微信</p>
                                    <input type="checkbox" name="wechat" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="0" data-type123="1">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/pm-zhifubao.png" style="width:50px;height:50px;margin:25px">
                                    <p>官方支付宝</p>
                                    <input type="checkbox" name="ali" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="0" data-type123="0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/pm-xindalu.png" style="width:50px;height:50px;margin:25px">
                                    <p>新大陆</p>
                                    <input type="checkbox" name="xdl" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="0" data-type123="4">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/pm-fuyou.png" style="width:50px;height:50px;margin:25px">
                                    <p>富友</p>
                                    <input type="checkbox" name="fuyou" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="0" data-type123="2">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/pm-yirongma.png" style="width:50px;height:50px;margin:25px">
                                    <p>易融码</p>
                                    <input type="checkbox" name="yirongma" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="0" data-type123="3">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/pm-suixingfu.png" style="width:50px;height:50px;margin:25px">
                                    <p>随行付</p>
                                    <input type="checkbox" name="suixingfu" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="0" data-type123="5">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 自有应用管理 -->
            <div class="layui-fluid">
                <blockquote class="layui-elem-quote" style="font-size: 20px;">自有应用管理</blockquote>
                <div class="layui-row layui-col-space1 ThirdBody" style="margin-bottom:20px" id="listTop">
                    <!-- <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body" style="height:180px">
                                <div class="ThirdListB">
                                    <img src="../../public/images/diancan.png" style="width:50px;height:50px;margin:25px">
                                    <p>点餐系统</p>
                                    <input type="checkbox" name="diancan" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/saoma.png" style="width:50px;height:50px;margin:25px">
                                    <p>扫码点餐</p>
                                    <input type="checkbox" name="saoma" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="1">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/huiyuanka.png" style="width:50px;height:50px;margin:25px">
                                    <p>会员卡系统</p>
                                    <input type="checkbox" name="huiyuanka" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="2">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/youhuiquan.png" style="width:50px;height:50px;margin:25px">
                                    <p>优惠券系统</p>
                                    <input type="checkbox" name="youhuiquan" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="3">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/ciyueka.png" style="width:50px;height:50px;margin:25px">
                                    <p>次/月卡系统</p>
                                    <input type="checkbox" name="ciyueka" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="4">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/yingxiao.png" style="width:50px;height:50px;margin:25px">
                                    <p>营销系统</p>
                                    <input type="checkbox" name="yingxiao" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="5">
                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
                <div class="layui-row layui-col-space1 ThirdBody" id="listBottom">
                    <!-- <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/huabei.png" style="width:50px;height:50px;margin:25px">
                                    <p>花呗分期</p>
                                    <input type="checkbox" name="huabei" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="6">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/weixinfenzhang.png" style="width:50px;height:50px;margin:25px">
                                    <p>微信分账</p>
                                    <input type="checkbox" name="weixinfenzhang" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="7">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/weixinshualian.png" style="width:50px;height:50px;margin:25px">
                                    <p>微信刷脸</p>
                                    <input type="checkbox" name="weixinshualian" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="8">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/alishualian.png" style="width:50px;height:50px;margin:25px">
                                    <p>支付宝刷脸</p>
                                    <input type="checkbox" name="alishualian" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="9">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/api.png" style="width:50px;height:50px;margin:25px">
                                    <p>API功能</p>
                                    <input type="checkbox" name="api" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="10">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/fapiao.png" style="width:50px;height:50px;margin:25px">
                                    <p>电子发票</p>
                                    <input type="checkbox" name="fapiao" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="11">
                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
        </form>
        <!-- <div class="layui-form-item layui-layout-admin">
            <div class="layui-input-block">
                <div class="layui-footer" style="left: 0;text-align: center;">
                    <button class="layui-btn" lay-submit="" lay-filter="add1">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary" id="quxiao">取消</button>
                </div>
                
            </div>
        </div> -->
    </div>
    <script src="../../common/config-shadmin.js"></script>
    <script src="../../common/utility.js"></script>
    <script>
    var serverUrl = window.parent.serverUrl
    var userNumber = window.location.search.split('?ins=')[1]
    console.log(userNumber)
    var imgList = [
        '../../public/images/diancan.png',
        '../../public/images/saoma.png',
        '../../public/images/huiyuanka.png',
        '../../public/images/youhuiquan.png',
        '../../public/images/ciyueka.png',
        '../../public/images/yingxiao.png',
        '../../public/images/huabei.png',
        '../../public/images/weixinfenzhang.png',
        '../../public/images/weixinshualian.png',
        '../../public/images/alishualian.png',
        '../../public/images/api.png',
        '../../public/images/fapiao.png',
        '../../public/images/yushouquan.jpg'
    ]
    layui.use(['laydate', 'table', 'upload', 'form'], function() { //独立版的layer无需执行这一句
        var $ = layui.jquery,
            upload = layui.upload,
            laydate = layui.laydate,
            table = layui.table,
            form = layui.form,
            admin = layui.admin,
            element = layui.element,
            layer = layui.layer; //独立版的layer无需执行这一句

        CmsUtility.postAjaxCall(
            //系统设置
            'bcrmIns/getInsAuthoritys', {
                "institutionNumber": userNumber
            },
            function(data) {
                if (data.code == 1000) {

                    var paymentChannel = data.data.paymentChannel
                    for (var i = 0; i < paymentChannel.length; i++) {
                        switch (paymentChannel[i].type) {
                            case 0:
                                form.val('cardAdd', {
                                    "ali": paymentChannel[i].status == 0 ? true : false
                                })
                                break;
                            case 1:
                                form.val('cardAdd', {
                                    "wechat": paymentChannel[i].status == 0 ? true : false
                                })
                                break;
                            case 2:
                                form.val('cardAdd', {
                                    "fuyou": paymentChannel[i].status == 0 ? true : false
                                })
                                break;
                            case 3:
                                form.val('cardAdd', {
                                    "yirongma": paymentChannel[i].status == 0 ? true : false
                                })
                                break;
                            case 4:
                                form.val('cardAdd', {
                                    "xdl": paymentChannel[i].status == 0 ? true : false
                                })
                                break;
                            case 5:
                                form.val('cardAdd', {
                                    "suixingfu": paymentChannel[i].status == 0 ? true : false
                                })
                                break;
                            default:
                                // statements_def
                                break;
                        }
                    }
                    var apps = data.data.apps
                    var strTop = '',
                        strBottom = ''
                    for (var i = 0; i < 7; i++) {
                        apps[i].onTrue = apps[i].status == 0 ? true : false
                        console.log(apps[i].onTrue)
                        if (apps[i].onTrue == true) {
                            strTop += '<div class="layui-col-xs4 layui-col-md1 ThirdList"><div class="layui-card"><div class="layui-card-body" style="height:180px"><div class="ThirdListB"><img src="' + imgList[i] + '" style="width:50px;height:50px;margin:25px"> <p>' + apps[i].applyName + '</p>  <input type="checkbox" name="diancan" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="' + apps[i].type + '" checked="' + apps[i].onTrue + '"> </div> </div> </div></div>'
                        } else {
                            strTop += '<div class="layui-col-xs4 layui-col-md1 ThirdList"><div class="layui-card"><div class="layui-card-body" style="height:180px"><div class="ThirdListB"><img src="' + imgList[i] + '" style="width:50px;height:50px;margin:25px"> <p>' + apps[i].applyName + '</p>  <input type="checkbox" name="diancan" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="' + apps[i].type + '" > </div> </div> </div></div>'

                        }



                    }
                    $('#listTop').html(strTop)
                    for (var i = 7; i < apps.length; i++) {
                        apps[i].onTrue = apps[i].status == 0 ? true : false
                        console.log(apps[i].onTrue)
                        if (apps[i].onTrue == true) {
                            strBottom += '<div class="layui-col-xs4 layui-col-md1 ThirdList"><div class="layui-card"><div class="layui-card-body" style="height:180px"><div class="ThirdListB"><img src="' + imgList[i] + '" style="width:50px;height:50px;margin:25px"> <p>' + apps[i].applyName + '</p>  <input type="checkbox" name="diancan" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="' + apps[i].type + '" checked="' + apps[i].onTrue + '"> </div> </div> </div></div>'
                        } else {
                            strBottom += '<div class="layui-col-xs4 layui-col-md1 ThirdList"><div class="layui-card"><div class="layui-card-body" style="height:180px"><div class="ThirdListB"><img src="' + imgList[i] + '" style="width:50px;height:50px;margin:25px"> <p>' + apps[i].applyName + '</p>  <input type="checkbox" name="diancan" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="1" data-type123="' + apps[i].type + '" > </div> </div> </div></div>'
                        }


                    }
                    $('#listBottom').html(strBottom)
                    form.render()
                } else {
                    layer.msg(data.msg)
                }
            },
            function(data) {
                console.log('222')
            }
        )

        form.on('switch(switchTest)', function(data) { //计次开关

            console.log(this.checked)
            CmsUtility.postAjaxCall(
                //系统设置
                'bcrmIns/updateInsAuthoritys', {
                    "institutionNumber": userNumber,
                    "AuthoritysType": data.elem.dataset.type,
                    "type": data.elem.dataset.type123,
                    "status": this.checked ? '0' : '1'

                },
                function(data) {
                    layer.msg(data.msg)
                    if (data.code == 1000) {


                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        });
        form.on('submit(add1)', function(data, index) {


            CmsUtility.postAjaxCall(
                //系统设置
                'bcrmIns/updateInsAuthoritys', {
                    "institutionNumber": userNumber,
                    "AuthoritysType": 0,

                },
                function(data) {
                    if (data.code == 1000) {
                        if (data.data == null) {
                            layer.msg(data.msg)
                        } else {


                        }

                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        })
        // $('.ThirdBody .ThirdList').on('click', function() {
        //     var othis = $(this),
        //         method = othis.data('method');
        //     active[method] ? active[method].call(this, othis) : '';
        // });

    });
    </script>
</body>

</html>