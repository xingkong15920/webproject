<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <script type="text/javascript" src="../../public/js/tableSelect.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-textarea {
                min-height: initial;
                letter-spacing: 1px;
        }
        </style>
</head>

<body id="iosiframe">
    <div class="x-body">
        <div class="layui-row">
            <form class="layui-form" action="" lay-filter="tongdao">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">微信参数</legend>
                </fieldset>
                <div class="layui-form-item">
                    <label class="layui-form-label">公众号APPID</label>
                    <div class="layui-input-block">
                        <input type="text" name="wechatAppid" autocomplete="off" placeholder="公众号APPID" class="layui-input" lay-verify="wxappid">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">公众号APPScrect</label>
                    <div class="layui-input-block">
                        <input type="text" name="wechatappsecret" autocomplete="off" placeholder="公众号APPScrect" class="layui-input" lay-verify="wxappid1">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">小程序APPID</label>
                    <div class="layui-input-block">
                        <input type="text" name="smallroutineAppid" autocomplete="off" placeholder="小程序APPID" class="layui-input" lay-verify="miniappid">
                    </div>
                </div>
                <div class="layui-form-item">
                        <label class="layui-form-label">小程序AppSecret</label>
                        <div class="layui-input-block">
                            <input type="text" name="miniAppsecret" autocomplete="off" placeholder="小程序AppSecret" class="layui-input" lay-verify="miniAppSecret">
                        </div>
                    </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">推荐关注APPID</label>
                    <div class="layui-input-block">
                        <input type="text" name="recommendAppid" autocomplete="off" placeholder="推荐关注公众号APPID" class="layui-input" lay-verify="appsecret1">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">支付授权目录</label>
                    <div class="layui-input-block">
                        <input type="text" name="paymentAuthorization" autocomplete="off" placeholder="支付授权目录" class="layui-input" lay-verify="appsecret2">
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend  style="font-weight: 500;">支付宝参数</legend>
                </fieldset>
                <div id="disanfang">
                    <div class="layui-form-item">
                        <label class="layui-form-label">PID</label>
                        
                        <div class="layui-input-block">
                        <input type="text" name="aliPID" autocomplete="off" placeholder="支付宝PID" class="layui-input" lay-verify="aliPID"> </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">支付宝Appid</label>
                        
                        <div class="layui-input-block">
                        <input type="text" name="aliAppid" autocomplete="off" placeholder="支付宝Appid" class="layui-input" lay-verify="appsecret3">
                    </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商户RSA私钥</label>
                        <div class="layui-input-block">
                            <textarea class="layui-textarea" name="aliPrivateKey" autocomplete="off" placeholder="RSA私钥" lay-verify="title" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商户RSA公钥</label>
                        <div class="layui-input-block">
                            <textarea class="layui-textarea" name="aliPublicKey" autocomplete="off" placeholder="RSA公钥" lay-verify="title" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">支付宝应用公钥</label>
                        <div class="layui-input-block">
                            <textarea class="layui-textarea" name="aliPayPublicKey" autocomplete="off" placeholder="应用公钥" lay-verify="title" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">易融码参数</legend>
                </fieldset>
                <div class="layui-form-item">
                    <label class="layui-form-label">支付前缀</label>
                    <div class="layui-input-block">
                        <input type="text" name="prefixPayment" autocomplete="off" placeholder="支付前缀(默认请写机构号)" class="layui-input" lay-verify="prefixPayment">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">机构号</label>
                    <div class="layui-input-block">
                        <input type="text" name="paymentInstitutionNo" autocomplete="off" placeholder="机构号" class="layui-input" lay-verify="appsecret4">
                    </div>
                </div>
               
                <div class="layui-form-item">
                    <label class="layui-form-label">机构秘钥</label>
                    <div class="layui-input-block">
                        <textarea class="layui-textarea" name="paymentInstitutionKey" autocomplete="off" placeholder="机构秘钥" lay-verify="fygongyao" rows="3"></textarea>
                    </div>
                </div>
                 <div class="layui-form-item">
                    <label class="layui-form-label">销售ID</label>
                    <div class="layui-input-block">
                        <input type="text" name="sellId" autocomplete="off" placeholder="销售ID" class="layui-input" lay-verify="appsecret5">
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">其他信息</legend>
                </fieldset>
                <div class="layui-form-item">
                    <label class="layui-form-label">回调地址</label>
                    <div class="layui-input-block">
                        <textarea class="layui-textarea" name="notifyUrl" autocomplete="off" placeholder="回调地址" rows="3" lay-verify="huidiaodizhi"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">支付网关</label>
                    <div class="layui-input-block">
                        <textarea class="layui-textarea" name="paymentGateway" autocomplete="off" placeholder="支付网关" rows="3" lay-verify="zhifuwangguan"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">通道状态</label>
                    <div class="layui-input-block">
                        <input type="checkbox" name="disable" lay-skin="switch" lay-filter="fyswitch" lay-text="开|关" checked>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">中文名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="paymentName" autocomplete="off" placeholder="请输入通道中文名称" class="layui-input" lay-verify="paymentName">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">英文名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="paymentSpell" autocomplete="off" placeholder="请输入通道英文名称,建议英文首字母" class="layui-input" lay-verify="paymentSpell">
                    </div>
                </div>
                <div class="layui-form-item layui-layout-admin">
                    <div class="layui-input-block">
                        <div class="layui-footer" style="left: 0;text-align: center;">
                            <button class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
                            <button type="reset" class="layui-btn layui-btn-primary" id="quxiao" onclick="x_admin_close()">取消</button>
                        </div>
                        <!--<i class="layui-icon" lay-tips="推荐追求开发效率和缺乏前端开发经验的使用，后端开发者的最爱。">123123123</i>-->
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="../../common/config-organ.js"></script>
    <script src="../../common/utility.js"></script>
    <script>
    function changeRes(res) {
        var res = res
        if (res.length == 0) {
            return
        }
        for (var i = 0; i < res.length; i++) {

        }
        return res
    }
    var serverUrl = window.parent.serverUrl
    var userNumber = JSON.parse(sessionStorage.getItem('organUser')).institutionNumber;
    var merchantCa = true;
    layui.use(['laydate', 'table', 'upload', 'form'], function() {
        var $ = layui.jquery,
            upload = layui.upload,
            laydate = layui.laydate,
            table = layui.table,
            form = layui.form,
            admin = layui.admin,
            element = layui.element,
            layer = layui.layer;

        //退款证书
        upload.render({
            elem: '#tuikuanchoose',
            url: '/upload/',
            accept: 'file',
            auto: false,
            bindAction: '#tuikuanupload',
            done: function(res) {
                console.log(res)
            }
        });
        //域名校验文件
        upload.render({
            elem: '#yumingchoose',
            url: '/upload/',
            accept: 'file',
            auto: false,
            bindAction: '#yumingupload',
            done: function(res) {
                console.log(res)
            }
        });

        /*---------- 自定义验证规则 ----------*/
        form.verify({
            paymentName: function(value) {
                if (value.length == "") {
                    return '通道中文名称不能为空！';
                }
            },
            paymentSpell: function(value) {
                if (value.length == "") {
                    return '通道英文名称不能为空！';
                }
                
                var newReg = new RegExp('^[0-9a-zA-Z]+$')
                if(!newReg.test(value)){
                    return '通道英文名称只能为英文或数字'
                }
            },
            title: function(value) {
                if (value.length == "") {
                    return '不能为空！'
                }
            },
            wxappid: function(value) {
                if (value.length == "") {
                    return '微信APPID不能为空！';
                }
            },
            wxappid1: function(value) {
                if (value.length == "") {
                    return '公众号APPScrect不能为空！';
                }
            },
            miniappid: function(value) {
                if (value.length == "") {
                    return '小程序APPID不能为空！';
                }
            },
            siyao: function(value) {
                if (value.length == "") {
                    return '商户私钥不能为空！';
                }
            },
            gongyao: function(value) {
                if (value.length == "") {
                    return '商户公钥不能为空！';
                }
            },
            fygongyao: function(value) {
                if (value.length == "") {
                    return '易融码公钥不能为空！';
                }
            },
            jigouhao: function(value) {
                if (value.length == "") {
                    return '机构号不能为空！';
                }
            },
            huidiaodizhi: function(value) {
                if (value.length == "") {
                    return '回调地址不能为空';
                }
            },
            zhifuwangguan: function(value) {
                if (value.length == "") {
                    return '支付网关不能为空';
                }
            },
            prefixPayment: function(value) {
                if (value.length == "") {
                    return '支付前缀不能为空';
                }
            },
            entryKey: function(value) {
                if (value.length == "") {
                    return '易融码进件秘钥不能为空';
                }
            },
            entryFtpN: function(value) {
                if (value.length == "") {
                    return '进件FTP账号不能为空';
                }
            },
            entryFtpP: function(value) {
                if (value.length == "") {
                    return '进件FTP密码不能为空';
                }
            },
            appsecret1:function(value){
                if (value.length == "") {
                    return '推荐关注appid不能为空';
                }
            },
            appsecret2:function(value){
                if (value.length == "") {
                    return '支付授权目录不能为空';
                }
            },
             appsecret3:function(value){
                if (value.length == "") {
                    return '支付宝APPid不能为空';
                }
            },
            appsecret4:function(value){
                if (value.length == "") {
                    return '机构号不能为空';
                }
            },
            appsecret5:function(value){
                if (value.length == "") {
                    return '销售ID不能为空';
                }
            },
            miniAppSecret:function(value){
                if(value.length == ""){
                    return '微笑小程序AppSecret不能为空'
                }
            }
        });

        form.on('switch(fyswitch)', function(data) { //计次开关
            layer.tips('易融码通道：' + (this.checked ? '已开启' : '已关闭'), data.othis)
            merchantCa = this.checked
        });

        /*---------- 监听提交 ----------*/
        form.on('submit(add)', function(data, index) {

            var addData = data.field
            addData.paymentType = 3
            if (merchantCa == false) {
                addData.disable = 1
            } else {
                addData.disable = 0
            }
            addData.institutionNumber = userNumber;
            // 发送请求
            console.log(addData)
            CmsUtility.postAjaxCall(
                //系统设置
                CmsConfig.addressUrl.Mechanism.insertYrmOfficial,
                addData,
                function(data) {
                    if (data.code == '1000') {
                        layer.msg('添加成功')
                        setTimeout(function() {
                            x_admin_close()
                            parent.layui.table.reload('vip_cardList')
                        }, 500)

                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
            return false;
            return false;
        });

    });
    </script>
</body>

</html>