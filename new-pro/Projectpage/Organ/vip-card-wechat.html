<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/font.css">
    <link rel="stylesheet" href="../../public/fonts/icon/iconfont.css">
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <link rel="stylesheet" href="../../public/css/card.css">
    <link rel="stylesheet" href="../../public/css/vipS.css">
    <script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../../public/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <script type="text/javascript" src="../../public/js/tableSelect.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    <style type="text/css">
    .cardSet .layui-upload-list {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
    }

    .cardSet .upTips {
        /* display: block; */
        position: initial;
        line-height: 40px;
        background: #1E9FFF;
        color: #fff;
        border: none;
        border-radius: 0;
    }

    .cardSet .layui-textarea {
        border-radius: 0;
        border-bottom-left-radius: 6px;
        border-bottom-right-radius: 6px;
    }

    .iwList li {
        margin-bottom: 20px;
        position: relative;
    }

    .iwList img {
        height: 222px;
    }

    .iwList .layui-input-block {
        margin: 0;
    }

    .iwList .imgDel {
        line-height: 222px;
    }

    .iwList .delBtn {
        position: absolute;
        right: -20px;
        top: -20px;
    }

    .iwList .layui-upload-list {
        border: 1px solid #e6e6e6;
        border-bottom: none;
    }

    .layui-elem-quote .layui-form-switch {
        width: 50px;
    }

    .layui-form-switch em {
        top: -1px;
    }

    .layui-form-switch i {
        top: 2px;
    }
    </style>
</head>

<body id="iosiframe" class="iframe_index_1 autoHeight">
    <script type="text/javascript">
    $(function() {
        var navH = $(".cardSetpreview").offset().top;
        $(window).scroll(function() {
            var scroH = $(this).scrollTop();
            if (scroH >= navH) {
                $(".cardSetpreview").css({
                    'top': '10px'
                });
            } else if (scroH < navH) {
                $(".cardSetpreview").css({
                    'top': '93px'
                });
            }
        })
    })
    </script>
    <div class="x-body iframe_index_1_con">
        <div class="layui-row">
            <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
                <div class="layui-form-item consumeCard">
                    <div class="layui-input-inline widthauto">
                        <label class="layui-form-label widthauto">会员卡ID :</label>
                        <div class="layui-form-mid clubcardId"></div>
                    </div>
                    <div class="layui-input-inline" style="display: flex;justify-content: space-between;align-items: center;width: calc(100% - 340px);margin: 0;">
                        <div class="layui-block" style="display: flex;justify-content: space-between;align-items: center;">
                            <label class="layui-form-label widthauto">会员卡状态 :</label>
                            <div class="layui-btn layui-btn-normal layui-btn-sm synchronous"></div>
                        </div>
                        <div class="layui-block" style="display: flex;justify-content: space-between;align-items: center;">
                            <label class="layui-form-label widthauto">会员卡模式 :</label>
                            <div class="layui-btn layui-btn-normal layui-btn-sm ">联盟</div>
                        </div>
                    </div>
                    <!-- <div class="layui-input-inline" style="display: flex;justify-content: space-between;align-items: center;width: 100px;margin: 0;">
                        <div class="layui-block" style="display: flex;justify-content: space-between;align-items: center;">
                            <label class="layui-form-label widthauto">会员卡模式 :</label>
                            <div class="layui-btn layui-btn-normal layui-btn-sm ">联盟</div>
                        </div>
                    </div> -->
                </div>
            </div>
            <div class="layui-col-xs3 layui-col-sm3 layui-col-md3 cardSetpreview" style="top: 93px;">
                <img src="./images/topbar.png" class="topbar">
                <div class="card_boby">
                    <div class="card_b card_bc1">
                        <img class="card_b_bg" src="./images/cardBg_default.png" id="cardBimg">
                        <div class="card_b_lt card_posi">
                            <img src="./images/card_logo.png" id="ppLogopv">
                            <div class="">
                                <p class="ltN"></p>
                                <p class="ltNamepv"></p>
                            </div>
                        </div>
                        <div class="card_b_ld card_posi">
                            <!-- <p><i class="icon icon icon-dailiguanli1"></i>黄金会员</p> -->
                            <p>NO.8888 8888 8888 8888</p>
                        </div>
                        <!-- <div class="card_b_rt card_posi">
								<span><i class="icon icon icon-dailiguanli1"></i></span>
								<p>黄金会员</p>
							</div>
							<div class="card_b_rd card_posi">
								<span><i class="icon icon icon-dailiguanli1"></i></span>
								<p>黄金会员</p>
							</div> -->
                    </div>
                    <ul class="card_qList">
                        <li class="card_qListli lishow">
                            <h3>积分</h3>
                            <p>1200</p>
                        </li>
                        <li class="card_qListli">
                            <h3>余额</h3>
                            <p>1200<span>(元)</span></p>
                        </li>
                        <li class="card_qListli">
                            <h3>优惠券</h3>
                            <p>12<span>(张)</span></p>
                        </li>
                        <li class="card_qListli">
                            <h3>等级</h3>
                            <p>Lv.12</p>
                        </li>
                    </ul>
                    <ul class="card_cList">
                        <li class="card_cListli">
                            <img src="./images/code_erwei.png">
                            <p>8888 8888 8888 8888</p>
                        </li>
                        <li class="card_cListli" style="display: none;">
                            <img src="./images/code_yiwei.png" style="width: 80%;">
                            <p>8888 8888 8888 8888</p>
                        </li>
                    </ul>
                </div>
                <ul class="card_fList" style="border-top: 1px solid #e6e6e6;">
                    <li class="card_fListli">
                        <div class="card_fListliDiv">
                            <p>推荐给朋友</p>
                            <span></span>
                        </div>
                        <i class="iconfont"></i>
                    </li>
                    <li class="card_fListli">
                        <div class="card_fListliDiv">
                            <p>会员卡详情</p>
                            <span></span>
                        </div>
                        <i class="iconfont"></i>
                    </li>
                    <li class="card_fListli">
                        <div class="card_fListliDiv">
                            <p>适用门店</p>
                            <span></span>
                        </div>
                        <i class="iconfont"></i>
                    </li>
                    <!-- <li class="card_fListli">
                        <p>会员卡详情</p>
                        <i class="iconfont"></i>
                    </li>
                    <li class="card_fListli">
                        <p>公众号</p>
                        <i class="iconfont"></i>
                    </li> -->
                </ul>
            </div>
            <div class="layui-col-xs9 layui-col-sm9 layui-col-md9 cardSet" style="margin-bottom: 44px;">
                <div class="layui-form" lay-filter="basic">
                    <blockquote class="layui-elem-quote consumeTit">
                        <i class="leftline"></i>
                        基本设置
                        <!-- <input type="checkbox" name="timePreferences" lay-skin="switch" lay-filter="timePreferences" lay-text="开|关">
								<span class="tips_red">设置目前卡的有效期</span> -->
                    </blockquote>
                    <div class="layui-form-item sysItem">
                        <div class="layui-form-item max600">
                            <label class="layui-form-label"><span class="redC">* </span>卡副标题</label>
                            <div class="layui-input-block">
                                <input type="text" name="subtitle" class="layui-input" lay-verify="ltName" id="ltName">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label"><span class="redC">* </span>栏位展示</label>
                            <div class="layui-input-block columnshow">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label"><span class="redC">* </span>条码展示</label>
                            <div class="layui-input-block barcodeshow">
                                <input type="radio" name="codeType" lay-filter="barcodeshow" value="0" title="二维码" checked="">
                                <input type="radio" name="codeType" lay-filter="barcodeshow" value="1" title="条形码">
                                <input type="radio" name="codeType" lay-filter="barcodeshow" value="2" title="不展示">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">商户服务</label>
                            <div class="layui-input-block merservices">
                            </div>
                        </div>
                        <!-- <div class="layui-form-item max600">
								<label class="layui-form-label">适用门店 :</label>
								<div class="layui-input-block">
									<input type="text" name="applyShops" class="layui-input" lay-verify="" id="symd" autocomplete="off"
									 ts-selected="" placeholder="请选择适用门店">
								</div>
								<label class="layui-form-label"></label>
								<div class="layui-form-mid layui-word-aux">空为不限制，门店核销或会员到店消费前，需要效验此项</div>
							</div> -->
                        <div class="layui-form-item">
                            <label class="layui-form-label">图文介绍</label>
                            <div class="layui-input-block">
                                <div class="layui-form-mid layui-word-aux">图片建议尺寸：900像素 * 500像素，大小不超过2M。至少上传1组图文，最多输入170字</div>
                                <ul class="layui-form-item max400 iwList" id="iwList"></ul>
                            </div>
                            <div class="layui-input-block" style="display: flex;justify-content: flex-start;align-items: center;margin-bottom: 15px;">
                                <button type="button" class="layui-btn" id="addSale" style="margin-right: 15px;">增加图文</button>
                            </div>
                        </div>
                    </div>
                    <!-- 自定义入口一 -->
                    <blockquote class="layui-elem-quote consumeTit">
                        <i class="leftline"></i>
                        自定义入口一
                    </blockquote>
                    <div class="layui-form-item custom1Body">
                        <div class="layui-form-item">
                            <div class="layui-input-block ">
                                <input type="radio" name="custom1" lay-filter="custom1" value="0" title="不设置">
                                <input type="radio" name="custom1" lay-filter="custom1" value="1" title="自定义链接" checked="">
                                <input type="radio" name="custom1" lay-filter="custom1" value="2" title="自定义小程序">
                            </div>
                        </div>
                        <div class="custom1B max600">
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redC">* </span>入口名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="custom1lNInput" class="layui-input customNameInput" id="custom1lNInput" value="" placeholder="入口名称">
                                </div>
                            </div>
                            <div class="custom1-link">
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>自定义链接</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom1lLInput" class="layui-input" lay-verify="customlLInput" id="custom1lLInput" placeholder="自定义链接地址">
                                    </div>
                                </div>
                            </div>
                            <div class="custom1-miniapp" style="display: none;">
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>小程序ID</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom1mIInput" class="layui-input" id="custom1mIInput" placeholder="小程序ID">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>小程序页面</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom1mPInput" class="layui-input" id="custom1mPInput" placeholder="小程序页面路径path">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">引导语</label>
                                <div class="layui-input-block">
                                    <input type="text" name="custom1mYInput" class="layui-input" id="custom1mYInput" placeholder="引导语">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 自定义入口二 -->
                    <blockquote class="layui-elem-quote consumeTit">
                        <i class="leftline"></i>
                        自定义入口二
                    </blockquote>
                    <div class="layui-form-item custom2Body">
                        <div class="layui-form-item">
                            <div class="layui-input-block ">
                                <input type="radio" name="custom2" lay-filter="custom2" value="0" title="不设置">
                                <input type="radio" name="custom2" lay-filter="custom2" value="1" title="自定义链接" checked="">
                                <input type="radio" name="custom2" lay-filter="custom2" value="2" title="自定义小程序">
                            </div>
                        </div>
                        <div class="custom2B max600">
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redC">* </span>入口名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="custom2lNInput" class="layui-input customNameInput" id="custom2lNInput" value="" placeholder="入口名称">
                                </div>
                            </div>
                            <div class="custom2-link">
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>自定义链接</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom2lLInput" class="layui-input" lay-verify="customlLInput" id="custom2lLInput" placeholder="自定义链接地址">
                                    </div>
                                </div>
                            </div>
                            <div class="custom2-miniapp" style="display: none;">
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>小程序ID</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom2mIInput" class="layui-input" id="custom2mIInput" placeholder="小程序ID">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>小程序页面</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom2mPInput" class="layui-input" id="custom2mPInput" placeholder="小程序页面路径path">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">引导语</label>
                                <div class="layui-input-block">
                                    <input type="text" name="custom2mYInput" class="layui-input" id="custom2mYInput" placeholder="引导语">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 自定义入口三 -->
                    <blockquote class="layui-elem-quote consumeTit">
                        <i class="leftline"></i>
                        自定义入口三
                    </blockquote>
                    <div class="layui-form-item custom3Body">
                        <div class="layui-form-item">
                            <div class="layui-input-block ">
                                <input type="radio" name="custom3" lay-filter="custom3" value="0" title="不设置">
                                <input type="radio" name="custom3" lay-filter="custom3" value="1" title="自定义链接" checked="">
                                <input type="radio" name="custom3" lay-filter="custom3" value="2" title="自定义小程序">
                            </div>
                        </div>
                        <div class="custom3B max600">
                            <div class="layui-form-item">
                                <label class="layui-form-label"><span class="redC">* </span>入口名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="custom3lNInput" class="layui-input customNameInput" id="custom3lNInput" value="" placeholder="入口名称">
                                </div>
                            </div>
                            <div class="custom3-link">
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>自定义链接</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom3lLInput" class="layui-input" lay-verify="customlLInput" id="custom3lLInput" placeholder="自定义链接地址">
                                    </div>
                                </div>
                            </div>
                            <div class="custom3-miniapp" style="display: none;">
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>小程序ID</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom3mIInput" class="layui-input" id="custom3mIInput" placeholder="小程序ID">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label"><span class="redC">* </span>小程序页面</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="custom3mPInput" class="layui-input" id="custom3mPInput" placeholder="小程序页面路径path">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">引导语</label>
                                <div class="layui-input-block">
                                    <input type="text" name="custom3mYInput" class="layui-input" id="custom3mYInput" placeholder="引导语">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 自定义入口四 -->
                    <!-- <blockquote class="layui-elem-quote consumeTit">
							<i class="leftline"></i>
							自定义入口四
							<input type="checkbox" name="timePreferences" lay-skin="switch" lay-filter="timePreferences" lay-text="开|关">
							<span class="tips_red">设置目前卡的有效期</span>
						</blockquote>
						<div class="layui-form-item sysItem">
							<div class="layui-form-item">
								<div class="layui-input-block ">
									<input type="radio" name="customFour" lay-filter="customFour" value="0" title="不设置">
									<input type="radio" name="customFour" lay-filter="customFour" value="1" title="自定义链接" checked="">
									<input type="radio" name="customFour" lay-filter="customFour" value="2" title="自定义小程序">
								</div>
							</div>
							<div class="customFourB max600">
								<div class="layui-form-item">
									<label class="layui-form-label">入口名称</label>
									<div class="layui-input-block">
										<input type="text" name="customFourlNInput" class="layui-input" lay-verify="" id="customFourlNInput" value="适用门店"
										 placeholder="入口名称">
									</div>
								</div>
								<div class="customFour-link">
									<div class="layui-form-item">
										<label class="layui-form-label">自定义链接</label>
										<div class="layui-input-block">
											<input type="text" name="customFourlLInput" class="layui-input" lay-verify="" id="customFourlLInput"
											 placeholder="自定义链接地址">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label">引导语</label>
										<div class="layui-input-block">
											<input type="text" name="customFourlYInput" class="layui-input" lay-verify="" id="customFourlYInput"
											 placeholder="引导语">
										</div>
									</div>
								</div>
								<div class="customFour-miniapp" style="display: none;">
									<div class="layui-form-item">
										<label class="layui-form-label">小程序ID</label>
										<div class="layui-input-block">
											<input type="text" name="customFourmIInput" class="layui-input" lay-verify="" id="customFourmIInput"
											 placeholder="小程序ID">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label">小程序页面</label>
										<div class="layui-input-block">
											<input type="text" name="customFourmPInput" class="layui-input" lay-verify="" id="customFourmPInput"
											 placeholder="小程序页面路径path">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label">引导语</label>
										<div class="layui-input-block">
											<input type="text" name="customFourmYInput" class="layui-input" lay-verify="" id="customFourmYInput"
											 placeholder="引导语">
										</div>
									</div>
								</div>
							</div>
						</div> -->
                    <div class="cardQrcode" style="display: none;">
                        <img src="./images/erweima.jpg">
                    </div>
                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
                        <div class="layui-block">
                            <div class="layui-footer" style="left: 0;text-align: center;">
                                <button class="layui-btn addBtn" lay-submit="" lay-filter="add">同步到微信</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../../common/config-organ.js"></script>
    <script src="../../common/utility.js"></script>
    <script>
    var insNumber = JSON.parse(sessionStorage.getItem('organUser')).institutionNumber;


    var cardCon;
    var chooseCnum
    var wxCardNo
    var shopNumbers = []
    var columnDVal = ["积分", "余额", "优惠券", "等级"]
    var merchantSL = ["免费WIFI", "可带宠物", "免费停车", "可外卖"]
    var imageTexts = []
    var imgNum = 0
    var customs = new Array()
    var isUpdata = false
    var wxCardNo = ''
    layui.use(['laydate', 'table', 'form', 'laytpl', 'upload'], function() {
        layui.$.support.cors = true; //允许ajax跨域
        var $ = layui.jquery,
            upload = layui.upload,
            laydate = layui.laydate,
            table = layui.table,
            form = layui.form,
            laytpl = layui.laytpl;
        var tableSelect = layui.tableSelect;
        var strL = ''
        for (let i = 0; i < columnDVal.length; i++) {


            strL +=
                '<input type="checkbox" class="set" lay-skin="primary" name="columnDisplay" lay-filter="columnDisplay" value="' +
                columnDVal[i] + '" title="' + columnDVal[i] + '">'

        }
        $('.columnshow').html(strL)
        var strS = ''
        for (let i = 0; i < merchantSL.length; i++) {

            strS += '<input type="checkbox" class="set" lay-skin="primary" name="merchantService" value="' +
                merchantSL[i] +
                '" title="' + merchantSL[i] + '" >'

        }
        $('.merservices').html(strS)
        form.render()
        // layer.load(2, {
        // 	shade: 0.5
        // });
        // $.ajax({
        // 	type: 'get',
        // 	url: CmsConfig.ServiceUrl.ApiRootUrlMeb + CmsConfig.addressUrl.Mervip.getAuthorizetInfo,
        // 	data: {
        // 		'authType': 1,
        // 		'merchantNumber': JSON.parse(sessionStorage.getItem('userSh')).Number,
        // 	},
        // 	dataType: 'json',
        // 	success: function(data) {
        // 		if (data.code == 1000) {
        // 			//查询有无会员卡
        // 			getCardCon()
        // 		} else if (data.code == 500) {
        // 			//代制会员卡
        // 			getCardCon()
        // 		} else if (data.code == '-2') {
        // 			layer.closeAll();
        // 			layer.msg('微信未授权，请先授权', function() {
        // 				window.location.href = 'unauth.html?authTypt=WeChat'
        // 			})
        // 		}
        // 	}
        // });
        getCardCon()

        function getCardCon() {
            // $.ajax({
            //     type: "get",
            //     url: CmsConfig.ServiceUrl.ApiRootUr + CmsConfig.addressUrl.Mervip.getCard,
            //     data: {
            //         "merchantNumber": merNumber
            //     },
            //     async: false,
            //     dataType: "json",
            //     headers: {
            //         "Content-Type": "application/json"
            //     },
            //     success: function(data) {
            //         if (data.code === 1000) {
            //             $('.ltN').text(data.data.cardName)
            //             $('#ppLogopv').attr('src', data.data.logoUrl)
            //             $('.card_b').css('background-color', data.data.color)
            //             $('.synchronous').text(data.data.wechatSynchronism == 0 ? '未同步微信' : '已同步微信')
            //             if (data.data.localImgUrl != null) {
            //                 $('.card_b_bg').attr('src', data.data.localImgUrl)
            //             } else {
            //                 $('.card_b_bg').remove()
            //             }
            //         } else {
            //             layer.closeAll('loading');
            //             $('.synchronous').text('无会员卡')
            //             // parent.layer.msg(data.msg)
            //         }
            //     }
            // });
            var getData = new Object()
            getData.institutionNumber = insNumber
            $.ajax({
                type: "post",
                url: CmsConfig.ServiceUrl.ApiRootUrl + 'wehatCard/getWechaCard',
                data: JSON.stringify(getData),
                async: false,
                dataType: "json",
                headers: {
                    "Content-Type": "application/json"
                },
                success: function(data) {
                    if (data.code === 1000) {
                        isUpdata = true
                        wxCardNo = data.data.wxCardNo
                        // 设置不可编辑项
                        $('#addSale').parent('div').hide()
                        // 设置不可编辑项
                        $('.synchronous').text(data.data.synch == 1 ? '未同步微信' : '已同步微信')
                        cardCon = data.data
                        setcardCon(data.data)
                        wxCardNo = data.data.wxCardNo
                        $('.clubcardId').text(data.data.wxCardNo)
                        $('.addBtn').text('更新到微信')
                        $('.ltNamepv').text(data.data.subtitle)
                        $('#cardBimg').show();
                        $('#cardBimg').attr('src', data.data.localImgUrl);
                        $('#ppLogopv').attr('src', data.data.logoUrl);
                        // 栏位展示
                        var strL = ''
                        var columnD = data.data.columnDisplay.split('||')
                        for (let i = 0; i < columnDVal.length; i++) {
                            if (columnD[0].indexOf(columnDVal[i]) >= 0) {
                                $('.card_qListli').eq(i).addClass('lishow');
                                strL +=
                                    '<input type="checkbox" class="set" lay-skin="primary" name="columnDisplay" lay-filter="columnDisplay" value="' +
                                    columnDVal[i] + '" title="' + columnDVal[i] + '" checked="">'
                            } else if (columnD.indexOf(columnDVal[i]) >= 0) {
                                $('.card_qListli').eq(i).addClass('lishow');
                                strL +=
                                    '<input type="checkbox" class="set" lay-skin="primary" name="columnDisplay" lay-filter="columnDisplay" value="' +
                                    columnDVal[i] + '" title="' + columnDVal[i] + '" checked="">'
                            } else {
                                strL +=
                                    '<input type="checkbox" class="set" lay-skin="primary" name="columnDisplay" lay-filter="columnDisplay" value="' +
                                    columnDVal[i] + '" title="' + columnDVal[i] + '">'
                            }
                        }
                        $('.columnshow').html(strL)

                        //条码展示
                        switch (data.data.codeType) {
                            case 0:
                                $('.card_cListli').eq(0).show()
                                $('.card_cListli').eq(1).hide()
                                break;
                            case 1:
                                $('.card_cListli').eq(0).hide()
                                $('.card_cListli').eq(1).show()
                                break;
                            case 3:
                                $('.card_cListli').hide()
                                break;
                        }

                        // 商户服务
                        var strS = ''
                        var merchantS = data.data.merchantService.split('||')
                        for (let i = 0; i < merchantSL.length; i++) {
                            if (merchantS.indexOf(merchantSL[i]) >= 0) {
                                strS += '<input type="checkbox" class="set" lay-skin="primary" name="merchantService" value="' +
                                    merchantSL[i] +
                                    '" title="' + merchantSL[i] + '" checked="" disabled="">'
                            } else {
                                strS += '<input type="checkbox" class="set" lay-skin="primary" name="merchantService" value="' +
                                    merchantSL[i] +
                                    '" title="' + merchantSL[i] + '" disabled="">'
                            }
                        }
                        $('.merservices').html(strS)

                        // 适用门店
                        // if (data.data.applyShops.length > 0) {
                        // 	var applyShopsList = []
                        // 	for (i = 0; i < data.data.applyShops.length; i++) {
                        // 		applyShopsList.push(data.data.applyShops[i].split('||')[0])
                        // 		shopNumbers.push(data.data.applyShops[i].split('||')[0])
                        // 	}
                        // 	$('#symd').val('已选 ' + data.data.applyShops.length + ' 个门店')
                        // 	$('#symd').attr('ts-selected', applyShopsList.join(','))
                        // } else {
                        // 	layer.msg('未查询到适用门店！')
                        // }


                        //图文列表
                        var strTW = ''
                        imageTexts = data.data.imageTexts
                        if (data.data.imageTexts != null) {
                            if (imageTexts && imageTexts.length > 0) {
                                for (let i = 0; i < imageTexts.length; i++) {
                                    strTW += '<li><input type="file" class="input_img layui-input" style="display: none;" id="upLogo' + i +
                                        '" />' +
                                        '<div class="layui-input-block pinpaiLogo' + i + '">' +
                                        '<div class="layui-upload-list">' +
                                        '<div class="layui-upload-img" id="cardLo' + i + '">' +
                                        '<img src="' + imageTexts[i].localImgUrl + '">' + '</div>' +
                                        '</div></div></div>' +
                                        '<textarea placeholder="图文内容建议上传商品、服务、环境等优质图片，并辅之以简单描述" id="imgText' + i +
                                        '" class="layui-textarea" disabled="">' + imageTexts[i].text +
                                        '</textarea></li>'
                                }
                            }
                        }

                        $('#iwList').html(strTW)

                        //自定义显示
                        var cus1 = cardCon.customs[0].customState
                        switch (cardCon.customs[0].customState) {
                            case 0:
                                $('.card_fListli').eq(0).hide()
                                $('.custom1B').hide()
                                $('#custom1lNInput').val('')
                                $('.card_fListli').eq(0).find('p').html('自定义入口一')
                                $('#custom1lNInput').removeAttr('lay-verify')
                                $('#custom1lLInput').removeAttr('lay-verify')
                                $('#custom1mIInput').removeAttr('lay-verify')
                                $('#custom1mPInput').removeAttr('lay-verify')
                                $('#custom1mYInput').removeAttr('lay-verify')
                                break;
                            case 1:
                                $('.card_fListli').eq(0).show()
                                $('.custom1B').show()
                                $('.custom1-link').show()
                                $('.custom1-miniapp').hide()
                                $('.card_fListli').eq(0).find('p').html(cardCon.customs[0].customName)
                                $('.card_fListli').eq(0).find('span').html(cardCon.customs[0].leadingInfo)
                                $('#custom1lNInput').attr('lay-verify', 'entryname')
                                $('#custom1lLInput').attr('lay-verify', 'customlLInput')
                                $('#custom1mIInput').removeAttr('lay-verify')
                                $('#custom1mPInput').removeAttr('lay-verify')
                                $('#custom1mYInput').attr('lay-verify', 'guideTips')
                                break;
                            case 2:
                                $('.card_fListli').eq(0).show()
                                $('.custom1B').show()
                                $('.custom1-link').hide()
                                $('.custom1-miniapp').show()
                                $('.card_fListli').eq(0).find('p').html(cardCon.customs[0].customName)
                                $('.card_fListli').eq(0).find('span').html(cardCon.customs[0].leadingInfo)
                                $('#custom1lNInput').attr('lay-verify', 'entryname')
                                $('#custom1lLInput').removeAttr('lay-verify')
                                $('#custom1mIInput').attr('lay-verify', 'custommIInput')
                                $('#custom1mPInput').attr('lay-verify', 'custommPInput')
                                $('#custom1mYInput').attr('lay-verify', 'guideTips')
                                break;
                        }
                        switch (cardCon.customs[1].customState) {
                            case 0:
                                $('.card_fListli').eq(1).hide()
                                $('.custom2B').hide()
                                $('#custom2lNInput').val('')
                                $('.card_fListli').eq(1).find('p').html('自定义入口二')
                                $('#custom2lNInput').removeAttr('lay-verify')
                                $('#custom2lLInput').removeAttr('lay-verify')
                                $('#custom2mIInput').removeAttr('lay-verify')
                                $('#custom2mPInput').removeAttr('lay-verify')
                                $('#custom2mYInput').removeAttr('lay-verify')
                                break;
                            case 1:
                                $('.card_fListli').eq(1).show()
                                $('.custom2B').show()
                                $('.custom2-link').show()
                                $('.custom2-miniapp').hide()
                                $('.card_fListli').eq(1).find('p').html(cardCon.customs[1].customName)
                                $('.card_fListli').eq(1).find('span').html(cardCon.customs[1].leadingInfo)
                                $('#custom2lNInput').attr('lay-verify', 'entryname')
                                $('#custom2lLInput').attr('lay-verify', 'customlLInput')
                                $('#custom2mIInput').removeAttr('lay-verify')
                                $('#custom2mPInput').removeAttr('lay-verify')
                                $('#custom2mYInput').attr('lay-verify', 'guideTips')
                                break;
                            case 2:
                                $('.card_fListli').eq(1).show()
                                $('.custom2B').show()
                                $('.custom2-link').hide()
                                $('.custom2-miniapp').show()
                                $('.card_fListli').eq(1).find('p').html(cardCon.customs[1].customName)
                                $('.card_fListli').eq(1).find('span').html(cardCon.customs[1].leadingInfo)
                                $('#custom2lNInput').attr('lay-verify', 'entryname')
                                $('#custom2lLInput').removeAttr('lay-verify')
                                $('#custom2mIInput').attr('lay-verify', 'custommIInput')
                                $('#custom2mPInput').attr('lay-verify', 'custommPInput')
                                $('#custom2mYInput').attr('lay-verify', 'guideTips')
                                break;
                        }
                        switch (cardCon.customs[2].customState) {
                            case 0:
                                $('.card_fListli').eq(2).hide()
                                $('.custom3B').hide()
                                $('#custom3lNInput').val('')
                                $('.card_fListli').eq(2).find('p').html('自定义入口三')
                                $('#custom3lNInput').removeAttr('lay-verify')
                                $('#custom3lLInput').removeAttr('lay-verify')
                                $('#custom3mIInput').removeAttr('lay-verify')
                                $('#custom3mPInput').removeAttr('lay-verify')
                                $('#custom3mYInput').removeAttr('lay-verify')
                                break;
                            case 1:
                                $('.card_fListli').eq(2).show()
                                $('.custom3B').show()
                                $('.custom3-link').show()
                                $('.custom3-miniapp').hide()
                                $('.card_fListli').eq(2).find('p').html(cardCon.customs[2].customName)
                                $('.card_fListli').eq(2).find('span').html(cardCon.customs[2].leadingInfo)
                                $('#custom3lNInput').attr('lay-verify', 'entryname')
                                $('#custom3lLInput').attr('lay-verify', 'customlLInput')
                                $('#custom3mIInput').removeAttr('lay-verify')
                                $('#custom3mPInput').removeAttr('lay-verify')
                                $('#custom3mYInput').attr('lay-verify', 'guideTips')
                                break;
                            case 2:
                                $('.card_fListli').eq(2).show()
                                $('.custom3B').show()
                                $('.custom3-link').hide()
                                $('.custom3-miniapp').show()
                                $('.card_fListli').eq(2).find('p').html(cardCon.customs[2].customName)
                                $('.card_fListli').eq(2).find('span').html(cardCon.customs[2].leadingInfo)
                                $('#custom3lNInput').attr('lay-verify', 'entryname')
                                $('#custom3lLInput').removeAttr('lay-verify')
                                $('#custom3mIInput').attr('lay-verify', 'custommIInput')
                                $('#custom3mPInput').attr('lay-verify', 'custommPInput')
                                $('#custom3mYInput').attr('lay-verify', 'guideTips')
                                break;
                        }

                        form.render()

                    } else if (data.code === -2) {
                        layer.closeAll('loading');
                        layer.msg(data.msg + '，请添加')
                        $('.clubcardId').text('无')
                        // 栏位展示
                        var strL = ''
                        for (let i = 0; i < columnDVal.length; i++) {
                            if (i == 0) {
                                strL += '<input type="checkbox" class="set" lay-skin="primary" name="columnDisplay" value="' +
                                    columnDVal[i] + '" title="' + columnDVal[i] +
                                    '" lay-filter="columnDisplay" checked="" disabled="">'
                            } else {
                                strL += '<input type="checkbox" class="set" lay-skin="primary" name="columnDisplay" value="' +
                                    columnDVal[i] + '" title="' + columnDVal[i] + '" lay-filter="columnDisplay">'
                            }
                        }
                        $('.columnshow').html(strL)


                        // 商户服务
                        var strS = ''
                        for (let i = 0; i < merchantSL.length; i++) {
                            strS += '<input type="checkbox" class="set" lay-skin="primary" name="merchantService" value="' +
                                merchantSL[i] +
                                '" title="' + merchantSL[i] + '">'
                        }
                        $('.merservices').html(strS)

                        form.render('checkbox')
                        cardCon = ''
                        $('.addBtn').attr('lay-filter', 'add')
                    } else {
                        isUpdata = false
                        layer.closeAll('loading');
                        parent.layer.msg(data.msg)

                    }
                }
            });
        }




        /*---------- 图文添加 ----------*/
        function saleListFor() {
            var str = ''
            for (let i = 0; i < imageTexts.length; i++) {
                str += '<li><input type="file" class="input_img layui-input" style="display: none;" id="upLogo' + i + '" />' +
                    '<div class="layui-input-block pinpaiLogo' + i + '">' +
                    '<div class="layui-upload-list">' +
                    '<div class="layui-upload-img" id="cardLo' + i + '" onclick="imgUp(' + i +
                    ')">' +
                    '<img id="cardLoImg' + i + '" src="' + imageTexts[i].localImgUrl + '">' +
                    '<div class="upTips">+<br />上传图片</div></div>' +
                    '<div class="imgDel" data-id="cardLo' + i + '" style="display: none;">' +
                    '<i class="layui-icon layui-unselect layui-tab-close">ဆ</i>' +
                    '</div></div></div>' +
                    '<textarea placeholder="图文内容建议上传商品、服务、环境等优质图片，并辅之以简单描述" id="imgText' + i +
                    '" class="layui-textarea" onclick="textIn(' + i + ')">' + imageTexts[i].text +
                    '</textarea><div class="delBtn delSale" data-id="' +
                    i + '"><i class="layui-icon layui-unselect layui-tab-close">ဆ</i></div></li>'
            }
            $('#iwList').html(str)

            /*---------- 图文设置 ----------*/
            window.textIn = function(i) {
                $('#imgText' + i).on("input", function(e) {
                    imageTexts[i].text = e.delegateTarget.value
                });
            }
            window.imgUp = function(i) {
                $('#upLogo' + i).click()
                imgNum = i
                $('.input_img').change(function() {
                    layer.load(2, {
                        shade: 0.5
                    });
                    uploadImg(this, function(data) {
                        uploadImgajax(data, 0)
                    });
                });
            }
            window.imgDel = function(i) {
                $('.layui-upload-img').on({
                    mouseover: function() {
                        var cardId = $(this).attr("id")
                        var cardSrc = $('#' + cardId + 'Img' + i).attr("src")
                        if (cardId === 'cardLo' && cardSrc) {
                            $('.pinpaiLogo .imgDel').css({
                                "display": "block",
                                "opacity": 1
                            })
                        }
                    }
                })
                $('.imgDel').on({
                    mouseleave: function() {
                        $('.imgDel').css({
                            "display": "none",
                            "opacity": 0
                        })
                    }
                })
                $('.imgDel').click(function(e) {
                    var delId = e.currentTarget.dataset.id
                    if (delId == 'cardLo' + i) {
                        $('#cardLo' + i).find('img').remove()
                        $(this).prev().find(".upTips").show()
                    }
                    $(this).hide()
                })
            }
        }
        // saleListFor()

        $('#addSale').click(function() {
            var newO = new Object()
            newO.text = ''
            newO.imageId = ''
            newO.localImgUrl = '../../public/images/default.png'
            imageTexts.push(newO)
            saleListFor()
            cli()
            char()
            give()
        })

        function cli() {
            $('.delSale').click(function(e) {
                if (imageTexts.length == 1) {
                    layer.msg('最少要保留一条图文信息')
                    return
                }
                var data = this
                var num = data.getAttribute('data-id')
                imageTexts.splice(num, 1)
                saleListFor()
                cli()
                char()
                give()
            })
        }

        function char() {
            $('.charge').bind("input propertychange", function(event) {
                imageTexts[this.dataset.id].text = this.value
            })
        }

        function give() {
            $('.give').bind("input propertychange", function(event) {
                imageTexts[this.dataset.id].imageId = this.value
            })
        }
        give()
        char()
        cli()

        /*---------- 单选复选监听 ----------*/
        form.on('checkbox(columnDisplay)', function(data) {
            if ($("input[name='columnDisplay']:checked").length > 3) {
                $(this).prop("checked", false);
                form.render('checkbox');
                layer.msg("最多只能选择3个标签", function() {});
            } else {
                var checkNum = columnDVal.indexOf(data.elem.value)
                if (data.elem.checked) {
                    $('.card_qListli').eq(checkNum).addClass('lishow');
                } else {
                    $('.card_qListli').eq(checkNum).removeClass('lishow')
                }
            }
        });
        form.on('radio(barcodeshow)', function(data) {
            if (data.value == 0) {
                $('.card_cListli').eq(0).show()
                $('.card_cListli').eq(1).hide()
            } else if (data.value == 1) {
                $('.card_cListli').eq(0).hide()
                $('.card_cListli').eq(1).show()
            } else if (data.value == 2) {
                $('.card_cListli').hide()
            }
        });

        // 自定义入口一
        form.on('switch(custom1Bodysw)', function(data) {
            if (data.elem.checked == true) {
                $('.custom1Body').show()
            } else if (data.elem.checked == false) {
                $('.custom1Body').hide()
            }
        });
        form.on('radio(custom1)', function(data) {
            console.log(data.value)
            if (data.value == 0) {
                $('.custom1B').hide()
                $('#custom1lNInput').val('')
                $('#custom1lNInput').removeAttr('lay-verify')
                $('#custom1lLInput').removeAttr('lay-verify')
                $('#custom1mIInput').removeAttr('lay-verify')
                $('#custom1mPInput').removeAttr('lay-verify')
                $('#custom1mYInput').removeAttr('lay-verify')
                $('.card_fListli').eq(0).hide()
            } else if (data.value == 1) {
                $('.card_fListli').eq(0).show()
                $('.custom1B').show()
                $('.custom1-link').show()
                $('.custom1-miniapp').hide()
                $('#custom1lNInput').attr('lay-verify', 'entryname')
                $('#custom1lLInput').attr('lay-verify', 'customlLInput')
                $('#custom1mIInput').removeAttr('lay-verify')
                $('#custom1mPInput').removeAttr('lay-verify')
                $('#custom1mYInput').attr('lay-verify', 'guideTips')
            } else if (data.value == 2) {
                $('.card_fListli').eq(0).show()
                $('.custom1B').show()
                $('.custom1-link').hide()
                $('.custom1-miniapp').show()
                $('#custom1lNInput').attr('lay-verify', 'entryname')
                $('#custom1lLInput').removeAttr('lay-verify')
                $('#custom1mIInput').attr('lay-verify', 'custommIInput')
                $('#custom1mPInput').attr('lay-verify', 'custommPInput')
                $('#custom1mYInput').attr('lay-verify', 'guideTips')
            }
        });
        $("#custom1lNInput").on("input", function(e) {
            if (e.delegateTarget.value == '') {
                $('.card_fListli').eq(0).find('p').html('自定义入口一')
            } else {
                $('.card_fListli').eq(0).find('p').html(e.delegateTarget.value)
            }
        });
        $("#custom1mYInput").on("input", function(e) {
            if (e.delegateTarget.value == '') {
                $('.card_fListli').eq(0).find('span').html('')
            } else {
                $('.card_fListli').eq(0).find('span').html(e.delegateTarget.value)
            }
        });
        // 自定义入口二
        form.on('switch(custom2Bodysw)', function(data) {
            if (data.elem.checked == true) {
                $('.custom2Body').show()
            } else if (data.elem.checked == false) {
                $('.custom2Body').hide()
            }
        });
        form.on('radio(custom2)', function(data) {
            if (data.value == 0) {
                $('.custom2B').hide()
                $('#custom2lNInput').val('')
                $('#custom2lNInput').removeAttr('lay-verify')
                $('#custom2lLInput').removeAttr('lay-verify')
                $('#custom2mIInput').removeAttr('lay-verify')
                $('#custom2mPInput').removeAttr('lay-verify')
                $('#custom2mYInput').removeAttr('lay-verify')
                $('.card_fListli').eq(1).hide()
            } else if (data.value == 1) {
                $('.card_fListli').eq(1).show()
                $('.custom2B').show()
                $('.custom2-link').show()
                $('.custom2-miniapp').hide()
                $('#custom2lNInput').attr('lay-verify', 'entryname')
                $('#custom2lLInput').attr('lay-verify', 'customlLInput')
                $('#custom2mIInput').removeAttr('lay-verify')
                $('#custom2mPInput').removeAttr('lay-verify')
                $('#custom2mYInput').attr('lay-verify', 'guideTips')
            } else if (data.value == 2) {
                $('.card_fListli').eq(1).show()
                $('.custom2B').show()
                $('.custom2-link').hide()
                $('.custom2-miniapp').show()
                $('#custom2lNInput').attr('lay-verify', 'entryname')
                $('#custom2lLInput').removeAttr('lay-verify')
                $('#custom2mIInput').attr('lay-verify', 'custommIInput')
                $('#custom2mPInput').attr('lay-verify', 'custommPInput')
                $('#custom2mYInput').attr('lay-verify', 'guideTips')
            }
        });
        $("#custom2lNInput").on("input", function(e) {
            if (e.delegateTarget.value == '') {
                $('.card_fListli').eq(1).find('p').html('自定义入口二')
            } else {
                $('.card_fListli').eq(1).find('p').html(e.delegateTarget.value)
            }
        });
        $("#custom2mYInput").on("input", function(e) {
            if (e.delegateTarget.value == '') {
                $('.card_fListli').eq(1).find('span').html('')
            } else {
                $('.card_fListli').eq(1).find('span').html(e.delegateTarget.value)
            }
        });
        // 自定义入口三
        form.on('switch(custom3Bodysw)', function(data) {
            if (data.elem.checked == true) {
                $('.custom3Body').show()
            } else if (data.elem.checked == false) {
                $('.custom3Body').hide()
            }
        });
        form.on('radio(custom3)', function(data) {
            if (data.value == 0) {
                $('.custom3B').hide()
                $('#custom3lNInput').val('')
                $('#custom3lNInput').removeAttr('lay-verify')
                $('#custom3lLInput').removeAttr('lay-verify')
                $('#custom3mIInput').removeAttr('lay-verify')
                $('#custom3mPInput').removeAttr('lay-verify')
                $('#custom3mYInput').removeAttr('lay-verify')
                $('.card_fListli').eq(2).hide()
            } else if (data.value == 1) {
                $('.card_fListli').eq(2).show()
                $('.custom3B').show()
                $('.custom3-link').show()
                $('.custom3-miniapp').hide()
                $('#custom3lNInput').attr('lay-verify', 'entryname')
                $('#custom3lLInput').attr('lay-verify', 'customlLInput')
                $('#custom3mIInput').removeAttr('lay-verify')
                $('#custom3mPInput').removeAttr('lay-verify')
                $('#custom3mYInput').attr('lay-verify', 'guideTips')
            } else if (data.value == 2) {
                $('.card_fListli').eq(2).show()
                $('.custom3B').show()
                $('.custom3-link').hide()
                $('.custom3-miniapp').show()
                $('#custom3lNInput').attr('lay-verify', 'entryname')
                $('#custom3lLInput').removeAttr('lay-verify')
                $('#custom3mIInput').attr('lay-verify', 'custommIInput')
                $('#custom3mPInput').attr('lay-verify', 'custommPInput')
                $('#custom3mYInput').attr('lay-verify', 'guideTips')
            }
        });
        $("#custom3lNInput").on("input", function(e) {
            if (e.delegateTarget.value == '') {
                $('.card_fListli').eq(2).find('p').html('自定义入口三')
            } else {
                $('.card_fListli').eq(2).find('p').html(e.delegateTarget.value)
            }
        });
        $("#custom3mYInput").on("input", function(e) {
            if (e.delegateTarget.value == '') {
                $('.card_fListli').eq(2).find('span').html('')
            } else {
                $('.card_fListli').eq(2).find('span').html(e.delegateTarget.value)
            }
        });
        // 自定义入口四
        form.on('radio(customFour)', function(data) {
            if (data.value == 0) {
                $('.customFourB').hide()
                $('#customFourlNInput').val('')
                $('.card_fListli').eq(3).children('p').html('自定义入口四')
            } else if (data.value == 1) {
                $('.customFourB').show()
                $('.customFour-link').show()
                $('.customFour-miniapp').hide()
                // $('.card_fListli').eq(2).children('p').html()
            } else if (data.value == 2) {
                $('.customFourB').show()
                $('.customFour-link').hide()
                $('.customFour-miniapp').show()
                // $('.card_fListli').eq(2).children('p').html()
            }
        });
        $("#customFourlNInput").on("input", function(e) {
            if (e.delegateTarget.value == '') {
                $('.card_fListli').eq(3).children('p').html('自定义入口四')
            } else {
                $('.card_fListli').eq(3).children('p').html(e.delegateTarget.value)
            }
        });

        /*---------- Input监听 ----------*/
        ltname()

        /*---------- 自定义验证规则 ----------*/
        form.verify({
            ltName: function(value) {
                if (value == '') {
                    return '副标题不能为空！'
                } else if (value != '') {
                    if (value.length >= 10) {
                        return '副标题不能超过10个字符！'
                    }
                }
            },
            guideTips: function(value) {
                if (value != '') {
                    if (value.length > 5) {
                        return '引导语不能超过5个字符'
                    }
                }
            },
            customlLInput: function(value) {
                if (value == '') {
                    return '自定义链接不能为空！'
                }
            },
            custommIInput: function(value) {
                if (value == '') {
                    return '小程序ID不能为空！'
                }
            },
            custommPInput: function(value) {
                if (value == '') {
                    return '小程序页面地址不能为空！'
                }
            },
            entryname: function(value) {
                if (value == '') {
                    return '入口名称不能为空！'
                }
                if (value.length > 5) {
                    return '入口名称不能超过5个字符'
                }
            },
        });

        //表单初始赋值
        function setcardCon(cardCon) {
            form.val('basic', {
                "subtitle": cardCon.subtitle,
                "codeType": '' + cardCon.codeType + '',
                "custom1": '' + cardCon.customs[0].customState + '',
                "custom1lNInput": cardCon.customs[0].customName,
                "custom1lLInput": cardCon.customs[0].customLink,
                "custom1mIInput": cardCon.customs[0].appletId,
                "custom1mPInput": cardCon.customs[0].appletLink,
                "custom1mYInput": cardCon.customs[0].leadingInfo,
                "custom2": '' + cardCon.customs[1].customState + '',
                "custom2lNInput": cardCon.customs[1].customName,
                "custom2lLInput": cardCon.customs[1].customLink,
                "custom2mIInput": cardCon.customs[1].appletId,
                "custom2mPInput": cardCon.customs[1].appletLink,
                "custom2mYInput": cardCon.customs[1].leadingInfo,
                "custom3": '' + cardCon.customs[2].customState + '',
                "custom3lNInput": cardCon.customs[2].customName,
                "custom3lLInput": cardCon.customs[2].customLink,
                "custom3mIInput": cardCon.customs[2].appletId,
                "custom3mPInput": cardCon.customs[2].appletLink,
                "custom3mYInput": cardCon.customs[2].leadingInfo,
            })
            ltname()
            layer.closeAll('loading');
        }
        //监听提交
        form.on('submit(update)', function(data) {
            customs = []
            var data = data.field
            // layer.alert(JSON.stringify(data.field), {
            //  title: '最终的提交信息'
            // })
            for (var i = 1; i < 4; i++) {
                var customNamel = new Object()
                customNamel.customNo = i
                customNamel.customState = data['custom' + i]
                customNamel.customName = data['custom' + i + 'lNInput']
                customNamel.customLink = data['custom' + i + 'lLInput']
                customNamel.leadingInfo = data['custom' + i + 'mYInput']
                customNamel.appletId = data['custom' + i + 'mIInput']
                customNamel.appletLink = data['custom' + i + 'mPInput']
                customs.push(customNamel)
            }
            data.customs = customs
            data.imageTexts = imageTexts

            var arrc = new Array();
            var arrm = new Array();
            $("input:checkbox[name='columnDisplay']:checked").each(function(i) {
                arrc[i] = $(this).val();
            });
            $("input:checkbox[name='merchantService']:checked").each(function(i) {
                arrm[i] = $(this).val();
            });
            data.columnDisplay = arrc.join('||');
            data.merchantService = arrm.join('||');
            data.institutionNumber = insNumber
            data.wxCardNo = wxCardNo
            // data.applyShops = shopNumbers
            data.applyShops = []
            if (shopNumbers != '') {
                data.shopJurisdiction = 1
            } else {
                data.shopJurisdiction = 0
            }
            console.log(data)
            layer.load(2, {
                shade: 0.5
            });

            // 发送请求
            $.ajax({
                type: "post",
                url: CmsConfig.ServiceUrl.ApiRootUrlMeb + CmsConfig.addressUrl.Mervip.updateWCard,
                data: JSON.stringify(data),
                dataType: "json",
                headers: {
                    "Content-Type": "application/json"
                },
                success: function(data) {
                    if (data.code === 1000) {
                        layer.closeAll('loading');
                        parent.layer.msg(data.msg)
                        location.replace(location.href)
                    } else {
                        layer.closeAll('loading');
                        parent.layer.msg(data.msg)
                    }
                }
            });
            return false;
        });
        //监听提交
        form.on('submit(add)', function(data) {

            customs = []
            var data = data.field
            // layer.alert(JSON.stringify(data.field), {
            //  title: '最终的提交信息'
            // })
            for (var i = 1; i < 4; i++) {
                var customNamel = new Object()
                customNamel.customNo = i
                customNamel.customState = data['custom' + i]
                customNamel.customName = data['custom' + i + 'lNInput']
                customNamel.customLink = data['custom' + i + 'lLInput']
                customNamel.leadingInfo = data['custom' + i + 'mYInput']
                customNamel.appletId = data['custom' + i + 'mIInput']
                customNamel.appletLink = data['custom' + i + 'mPInput']
                customs.push(customNamel)
            }
            data.customs = customs
            data.imageTexts = imageTexts

            var arrc = new Array();
            var arrm = new Array();
            $("input:checkbox[name='columnDisplay']:checked").each(function(i) {
                arrc[i] = $(this).val();
            });
            $("input:checkbox[name='merchantService']:checked").each(function(i) {
                arrm[i] = $(this).val();
            });
            data.columnDisplay = arrc.join('||');
            data.merchantService = arrm.join('||');
            data.institutionNumber = insNumber
            // data.applyShops = shopNumbers
            data.applyShops = []
            if (shopNumbers != '') {
                data.shopJurisdiction = 1
            } else {
                data.shopJurisdiction = 0
            }
            console.log(data)
            var tjData = new Object()
            tjData.institutionNumber = insNumber
            tjData.subtitle = data.subtitle
            tjData.columnDisplay = data.columnDisplay
            tjData.codeType = data.codeType
            tjData.shopJurisdiction = 0
            tjData.merchantService = data.merchantService
            tjData.customs = data.customs
            if(imageTexts.length == 0){
                layer.msg('请至少上传一组图片')
                return false 
            }
            tjData.imageTexts = imageTexts
            
            layer.load(2, {
                shade: 0.5
            });
            // return
            // 发送请求
            console.log(tjData)
            var tjUrl = ''
            var str = ''
            if (isUpdata == false) {
                tjUrl = CmsConfig.ServiceUrl.ApiRootUrl + 'wehatCard/addCard'
                str = "确定要同步到微信吗？"
            } else {
                tjUrl = CmsConfig.ServiceUrl.ApiRootUrl + 'wehatCard/updateCard'
                tjData.wxCardNo = wxCardNo
                str = "确定要更新到微信吗？"
            }
            layer.confirm(str, {
                icon: 3,
                title: '提示'
            }, function() {
                layer.closeAll()
                layer.load(2, {
                    shade: 0.5
                });
                $.ajax({
                    type: "post",
                    url: tjUrl,
                    data: JSON.stringify(tjData),
                    dataType: "json",
                    async:true,
                    headers: {
                        "Content-Type": "application/json"
                    },
                    success: function(data) {
                        if (data.code === 1000) {
                            layer.closeAll('loading');
                            layer.msg(data.msg)
                            // location.replace(location.href)
                        } else {
                            layer.closeAll('loading');
                            layer.msg(data.msg)
                        }
                    }
                });
            },function(){
            	layer.closeAll('loading');
            })

            return false;
        });
    });
    $('.card_qListli').click(function(e) {
        chooseCnum = $('.card_qListli').index(this) + 1
    })

    $('.chooseColor span').click(function(e) {
        chooseCnum = $('.chooseColor span').index(this) + 1
        $(this).siblings('span').removeClass('chooseCC layui-icon layui-icon-ok')
        $(this).addClass('chooseCC layui-icon layui-icon-ok')
        $('.card_b').attr("class", 'card_b card_bc' + chooseCnum)
    })

    function ltname() {
        $('.ltNamepv').text($("#ltName").val())
        $("#ltName").on("input", function(e) {
            //获取input输入的值
            $('.ltNamepv').text(e.delegateTarget.value)
        });
    }

    function uploadImg(input_file, get_data) {
        var file = input_file.files[0];
        var reader = new FileReader();
        var AllowImgFileSize = 2100000;
        if (file.size < AllowImgFileSize) {
            reader.readAsDataURL(file);
            reader.onload = function() {
                get_data(this.result)
            }
            $(input_file).val('')
        } else {
            layer.closeAll('loading');
            layer.msg('上传失败<br>请上传不大于2M的图片！', function() {});
            $(input_file).val('')
        }
    }

    function uploadImgajax(Imgbase, upType) {
        var datas = {
            "imgBaseStr": Imgbase,
            "institutionNumber": insNumber,
            "imgType": upType,
            "merchantNumber": ''
        }
        // 发送请求
        $.ajax({
            type: "post",
            url: 'http://api.51shanhe.com/p-member/cardManage/uploadImg',
            data: JSON.stringify(datas),
            dataType: "json",
            async: false,
            headers: {
                "Content-Type": "application/json"
            },
            success: function(data) {
                layer.closeAll('loading');
                if (data.code === 1000) {
                    imageTexts[imgNum].imageId = data.data.imageId
                    imageTexts[imgNum].localImgUrl = data.data.localImgUrl
                    $('#cardLoImg' + imgNum).attr('src', data.data.localImgUrl);
                    $('#cardLo' + imgNum).find('.upTips').hide();
                    // switch (upType) {
                    // 	case 1:
                    // 		logo_url = data.data.localImgUrl
                    // 		logo_id = data.data.imageId
                    // 		$('#cardLimg').attr('src', data.data.localImgUrl);
                    // 		$('#cardLoImg').attr('src', data.data.localImgUrl);
                    // 		$('#cardLo').find('.upTips').hide();
                    // 		break;
                    // 	case 2:
                    // 		coverPhoto = data.data.imageId
                    // 		coverPhotoUrl = data.data.localImgUrl
                    // 		$('.coverTit').hide()
                    // 		$('.coverCon').show()
                    // 		$('.coversys').css({
                    // 			'height': 'auto',
                    // 			'border-bottom': 'none'
                    // 		})
                    // 		$('#coverConImg').attr('src', data.data.localImgUrl);
                    // 		$('#cardBgImg').attr('src', data.data.localImgUrl);
                    // 		$('#cardBg').find('.upTips').hide();
                    // 		break
                    // 	case 4:
                    // 		layer.msg('上传系统图库成功')
                    // 		break
                    // 	case 6:
                    // 		imgTexts[imgNum].imageId = data.data.imageId
                    // 		imgTexts[imgNum].imgUrl = data.data.localImgUrl
                    // 		$('#cardLoImg' + imgNum).attr('src', data.data.localImgUrl);
                    // 		$('#cardLo' + imgNum).find('.upTips').hide();
                    // 		break
                    // }
                }
            }
        });
    }
    </script>
</body>

</html>