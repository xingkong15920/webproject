<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/font.css">
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    .layui-btn+.layui-btn {
        margin-left: -2px;
    }

    .border {
        box-shadow: 0 0 30px rgba(0, 0, 0, .1);
        padding: 15px;
    }

    .huizongTit {
        font-size: 20px;
        margin-bottom: 20px;
    }

    .huizongCon {
        font-size: 20px;
    }

    .huizongCon span {
        font-size: 20px;
    }
    </style>
</head>

<body id="iosiframe">
    <div class="x-nav">
        <span class="layui-breadcrumb">
				<a href="">首页</a>
				<a href="">财务分析</a>
				<a><cite>服务商统计分析</cite></a>
			</span>
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);"
			 title="刷新">
				<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
    </div>
    <div class="x-body">
        <div class="layui-row layui-col-space30">
            <!--汇总-->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend style="font-weight: 500;">服务商统计分析</legend>
            </fieldset>
            <!--报表-->
            <div style="display:block;height:513px;">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md4" style="width:95%">
                    <div class="grid-demo border">
                        <div class="">
                            <p class="x-red" style="font-size: 20px;margin-bottom: 15px;">服务商商户数TOP10</p>
                            <div class="grid-demo border" style="width:100%;overflow:auto">
                            <div id="main6" style="height: 550px;width:100%"></div>
                        </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="grid-demo border">
                        <div class="">
                            <p class="x-red" style="font-size: 20px;margin-bottom: 15px;">服务商订单金额TOP10(包含退款) </p>
                            <div class="grid-demo border" style="width:100%;overflow:auto">
                            <div id="main4" style="height: 500px;width:100%"></div>
                        </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6" style="overflow:hidden">
                    <div class="grid-demo border">
                        <div class="">
                            <p class="x-red" style="font-size: 20px;margin-bottom: 15px;">服务商订单笔数TOP10(包含退款)</p>
                            <div class="grid-demo border" style="width:100%;overflow:auto">
                            <div id="main5" style="height: 500px;width:100%"></div>
                        </div>
                        </div>
                    </div>
                </div>
                
            </div>
            <div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="grid-demo border">
                        <div class="">
                            <p class="x-red" style="font-size: 20px;margin-bottom: 15px;">服务商退款金额TOP10</p>
                            <div class="grid-demo border" style="width:100%;overflow:auto">
                            <div id="main2" style="height: 500px;width:100%"></div>
                        </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="grid-demo border">
                        <div class="">
                            <p class="x-red" style="font-size: 20px;margin-bottom: 15px;">服务商退款笔数TOP10</p>
                            <div class="grid-demo border" style="width:100%;overflow:auto">
                            <div id="main3" style="height: 500px;width:100%"></div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row layui-col-space30">
            <!--汇总-->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend style="font-weight: 500;">服务商佣金</legend>
            </fieldset>
            <!--报表-->
            <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                <div class="grid-demo border">
                    <div class="">
                        <p class="x-red" style="font-size: 20px;margin-bottom: 15px;">补贴金额TOP10</p>
                        <div class="grid-demo border" style="width:100%;overflow:auto">
                            <div id="main" style="height: 500px;width:100%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                <div class="grid-demo border">
                    <div class="">
                        <p class="x-red" style="font-size: 20px;margin-bottom: 15px;">补贴笔数TOP10 </p>
                        <div class="grid-demo border" style="width:100%;overflow:auto">
                            <div id="main1" style="height: 500px;width:100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../../common/config-organ.js"></script>
    <script src="../../common/utility.js"></script>
    <script type="text/javascript" src="../../public/js/echarts.min.js"></script>
    <script>
    function changeRes(res) {
        var res = res
        if (res.length == 0) {
            return
        }
        for (var i = 0; i < res.length; i++) {
            if (res[i].addtime != null) {
                res[i].addtimea = res[i].addtime.split(" ")[0]
            }
        }
        return res
    }
    var ddDate = []
    var ddData = []

    var serverUrl = window.parent.serverUrl
    var userNumber = JSON.parse(sessionStorage.getItem('organUser')).institutionNumber;
    //补贴参数
    var myChart = echarts.init(document.getElementById('main'));
    var myChart1 = echarts.init(document.getElementById('main1'));
    var shName = []
    var shMoney = []
    var shCount = []
    //退款参数
    var myChart2 = echarts.init(document.getElementById('main2'));
    var myChart3 = echarts.init(document.getElementById('main3'));
    var shName1 = []
    var shMoney1 = []
    var shCount1 = []
    //订单参数
    var myChart4 = echarts.init(document.getElementById('main4'));
    var myChart5 = echarts.init(document.getElementById('main5'));
    var shName2 = []
    var shMoney2 = []
    var shCount2 = []

    //商户数
    var myChart6 = echarts.init(document.getElementById('main6'));
    var shopCountList = []
var dailimingcheng = []
var zongshanghushu = []
var huoyueshanghu = []
var qianshuishanghu = []

    var myDate = new Date();
    var nowY = myDate.getFullYear();
    var nowM = myDate.getMonth() + 1;
    var nowD = myDate.getDate();
    var enddate = nowY + "-" + (nowM < 10 ? "0" + nowM : nowM) + "-" + (nowD < 10 ? "0" + nowD : nowD); //当前日期    
    console.log(enddate)
    var lw = new Date(myDate - 1000 * 60 * 60 * 24 * 30); //最后一个数字30可改，30天的意思
    var lastY = lw.getFullYear();
    var lastM = lw.getMonth() + 1;
    var lastD = lw.getDate();
    var startdate = lastY + "-" + (lastM < 10 ? "0" + lastM : lastM) + "-" + (lastD < 10 ? "0" + lastD : lastD);
    $('#startTime').val(startdate)
    $('#endTime').val(enddate)

    layui.use(['laydate', 'table', 'form', 'layer'], function() {
        var laydate = layui.laydate,
            table = layui.table,
            form = layui.form,
            layer = layui.layer;
        laydate.render({
            elem: '#couponName'
        })
        laydate.render({
            elem: '#startTime'
        })
        laydate.render({
            elem: '#endTime'
        })
        //补贴笔数
        var option1 = {
            title: {
                text: '',
                subtext: '',
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },

            series: [{
                type: 'pie',
                radius: '65%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                data: shCount,
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        };
        //补贴金额
        var option = {
            color: ['#3398DB'],
            tooltip: {
                trigger: 'axis',
                axisPointer: { // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [{
                type: 'category',
                data: shName,
                axisTick: {
                    alignWithLabel: true
                },
                axisLabel: {
                    interval: 0,
                    formatter: function(value) {

                        var ret = "";
                        var maxLength = 2;
                        var valLength = value.length;
                        var rowN = Math.ceil(valLength / maxLength);
                        if (rowN > 1) {
                            for (var i = 0; i < rowN; i++) {
                                var temp = ""; //每次截取的字符串  
                                var start = i * maxLength; //开始截取的位置  
                                var end = start + maxLength; //结束截取的位置  
                                //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  
                                temp = value.substring(start, end) + "\n";
                                ret += temp; //凭借最终的字符串  
                            }
                            return ret;
                        } else {
                            return value;
                        }
                    }
                }
            }],
            yAxis: [{
                type: 'value'
            }],
            series: [{
                name: '商户金额',
                type: 'bar',
                barWidth: '60%',
                data: shMoney
            }]
        };
        //退款笔数
        var option3 = {
            title: {
                text: '',
                subtext: '',
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },

            series: [{
                type: 'pie',
                radius: '65%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                data: shCount1,
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        };
        //退款金额
        var option2 = {
            color: ['#3398DB'],
            tooltip: {
                trigger: 'axis',
                axisPointer: { // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [{
                type: 'category',
                data: shName1,
                axisTick: {
                    alignWithLabel: true
                },
                axisLabel: {
                    interval: 0,
                    formatter: function(value) {

                        var ret = "";
                        var maxLength = 2;
                        var valLength = value.length;
                        var rowN = Math.ceil(valLength / maxLength);
                        if (rowN > 1) {
                            for (var i = 0; i < rowN; i++) {
                                var temp = ""; //每次截取的字符串  
                                var start = i * maxLength; //开始截取的位置  
                                var end = start + maxLength; //结束截取的位置  
                                //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  
                                temp = value.substring(start, end) + "\n";
                                ret += temp; //凭借最终的字符串  
                            }
                            return ret;
                        } else {
                            return value;
                        }
                    }
                }
            }],
            yAxis: [{
                type: 'value'
            }],
            series: [{
                name: '商户金额',
                type: 'bar',
                barWidth: '60%',
                data: shMoney1
            }]
        };
        //订单笔数
        var option5 = {
            title: {
                text: '',
                subtext: '',
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },

            series: [{
                type: 'pie',
                radius: '65%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                data: shCount2,
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        };
        //订单金额
        var option4 = {
            color: ['#3398DB'],
            tooltip: {
                trigger: 'axis',
                axisPointer: { // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [{
                type: 'category',
                data: shName2,
                axisTick: {
                    alignWithLabel: true
                },
                axisLabel: {
                    interval: 0,
                    formatter: function(value) {

                        var ret = "";
                        var maxLength = 2;
                        var valLength = value.length;
                        var rowN = Math.ceil(valLength / maxLength);
                        if (rowN > 1) {
                            for (var i = 0; i < rowN; i++) {
                                var temp = ""; //每次截取的字符串  
                                var start = i * maxLength; //开始截取的位置  
                                var end = start + maxLength; //结束截取的位置  
                                //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  
                                temp = value.substring(start, end) + "\n";
                                ret += temp; //凭借最终的字符串  
                            }
                            return ret;
                        } else {
                            return value;
                        }
                    }
                }
            }],
            yAxis: [{
                type: 'value'
            }],
            series: [{
                name: '商户金额',
                type: 'bar',
                barWidth: '60%',
                data: shMoney2
            }]
        };
        //商户数量
   //      var option6 = {
			//     legend: {},
			//     tooltip: {},
			//     dataset: {
			//         source: shopCountList
			//     },
			//     xAxis: {
			//     	type: 'category',
			//     	axisLabel: {
   //                  interval: 0,
   //                  formatter: function(value) {

   //                      var ret = "";
   //                      var maxLength = 3;
   //                      var valLength = value.length;
   //                      var rowN = Math.ceil(valLength / maxLength);
   //                      if (rowN > 1) {
   //                          for (var i = 0; i < rowN; i++) {
   //                              var temp = ""; //每次截取的字符串  
   //                              var start = i * maxLength; //开始截取的位置  
   //                              var end = start + maxLength; //结束截取的位置  
   //                              //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  
   //                              temp = value.substring(start, end) + "\n";
   //                              ret += temp; //凭借最终的字符串  
   //                          }
   //                          return ret;
   //                      } else {
   //                          return value;
   //                      }
   //                  }
   //              }},
			//     yAxis: {},
			//     // Declare several bar series, each will be mapped
			//     // to a column of dataset.source by default.
			//     series: [
			//         {type: 'bar',
			//         barWidth:20
			//     },
			//         {type: 'bar',
			//         barWidth:20},
			//         {type: 'bar',
			//         barWidth:20}
			//     ]
			// };
			var posList = [
    'left', 'right', 'top', 'bottom',
    'inside',
    'insideTop', 'insideLeft', 'insideRight', 'insideBottom',
    'insideTopLeft', 'insideTopRight', 'insideBottomLeft', 'insideBottomRight'
];
myChart6.configParameters = {
    rotate: {
        min: -90,
        max: 90
    },
    align: {
        options: {
            left: 'left',
            center: 'center',
            right: 'right'
        }
    },
    verticalAlign: {
        options: {
            top: 'top',
            middle: 'middle',
            bottom: 'bottom'
        }
    },
    position: {
        options: echarts.util.reduce(posList, function (map, pos) {
            map[pos] = pos;
            return map;
        }, {})
    },
    distance: {
        min: 0,
        max: 100
    }
};

myChart6.config = {
    rotate: 90,
    align: 'left',
    verticalAlign: 'middle',
    position: 'insideBottom',
    distance: 30,
    onChange: function () {
        var labelOption = {
            normal: {
                rotate: app.config.rotate,
                align: app.config.align,
                verticalAlign: app.config.verticalAlign,
                position: app.config.position,
                distance: app.config.distance
            }
        };
        myChart.setOption({
            series: [{
                label: labelOption
            }, {
                label: labelOption
            }, {
                label: labelOption
            }, {
                label: labelOption
            }]
        });
    }
};
var labelOption = {
    normal: {
        show: true,
        position: myChart6.config.position,
        distance: myChart6.config.distance,
        align: myChart6.config.align,
        verticalAlign: myChart6.config.verticalAlign,
        rotate: myChart6.config.rotate,
        formatter: '{c}  {name|{a}}',
        fontSize: 16,
        rich: {
            name: {
                textBorderColor: '#fff'
            }
        }
    }
};

var option6 = {
    color: ['#003366', '#006699', '#4cabce'],
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'shadow'
        }
    },
    grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
    legend: {
        data: ['总商户数', '活跃商户', '潜水商户']
    },
    toolbox: {
        show: true,
        orient: 'vertical',
        left: 'right',
        top: 'center',
        feature: {
            mark: {show: true},
            dataView: {show: true, readOnly: false},
            magicType: {show: true, type: ['line', 'bar', 'stack', 'tiled']},
            restore: {show: true},
            saveAsImage: {show: true}
        }
    },
    calculable: true,
    xAxis: [
        {
            type: 'category',
            axisTick: {show: false},
            data:dailimingcheng,
            axisLabel: {
                    interval: 0,
                    formatter: function(value) {

                        var ret = "";
                        var maxLength = 3;
                        var valLength = value.length;
                        var rowN = Math.ceil(valLength / maxLength);
                        if (rowN > 1) {
                            for (var i = 0; i < rowN; i++) {
                                var temp = ""; //每次截取的字符串  
                                var start = i * maxLength; //开始截取的位置  
                                var end = start + maxLength; //结束截取的位置  
                                //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  
                                temp = value.substring(start, end) + "\n";
                                ret += temp; //凭借最终的字符串  
                            }
                            return ret;
                        } else {
                            return value;
                        }
                    }
                }
        }
    ],
    yAxis: [
        {
            type: 'value'
        }
    ],
    series: [
        {
            name: '总商户数',
            type: 'bar',
            barGap: 0,
            barWidth:15,
            label: labelOption,
            data: zongshanghushu
        },
        {
            name: '活跃商户',
            type: 'bar',
            label: labelOption,
            data: huoyueshanghu,
            barWidth:15,
        },
        {
            name: '潜水商户',
            type: 'bar',
            label: labelOption,
            data: qianshuishanghu,
            barWidth:15,
        }
    ]
};		
        // CmsUtility.postAjaxCall(
        //     //系统设置
        //     CmsConfig.addressUrl.Mechanism.orderAbout, {
        //         "institutionNumber": userNumber
        //     },
        //     function(data) {
        //         if (data.code == '1000') {
        //             console.log(data)
        //             $('#orderAev').html(data.data.orderAev)
        //             $('#refoundPro').html(data.data.refoundPro)
        //             $('#successOrderAmount').html(data.data.successOrderAmount)
        //             $('#successOrderNumber').html(data.data.successOrderNumber)

        //         } else {
        //             layer.msg(data.msg)
        //         }
        //     },
        //     function(data) {
        //         console.log('222')
        //     }
        // )
        //服务商商户数TOP10  
        function shopCount() {
            // ddDate = []
            // ddData = []
            
            CmsUtility.postAjaxCall(
                //系统设置
                CmsConfig.addressUrl.Mechanism.getInsAgentMerCount, {
                    "institutionNumber": userNumber,
                    "page": 1,
                    "limit": 10
                },
                function(data) {

                    if (data.code == 1000) {
                        var res = data.data
                        var arr1 = ['product','总商户数','活跃商户','潜水商户']
                        shopCountList.push(arr1)
                        //                shName = []
                        // shMoney = []
                        for (var j = 0; j < res.length; j++) {
                            dailimingcheng.push(res[j].agentName)
                            zongshanghushu.push(res[j].merchantCount)
                            huoyueshanghu.push(res[j].activeMerCount)
                            qianshuishanghu.push(res[j].silenceMerCount)
                        }

                        // 为echarts对象加载数据
                        myChart6.clear()
                        myChart6.setOption(option6, 'true');
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        shopCount()
        table.render({
            //url: serverUrl + 'memberCard/getAssociatorCards?userNumber=' + userNumber,
            url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Mechanism.getInsAgentMerCount + '?institutionNumber=' +
                userNumber,
            elem: '#members1',
            id: 'vip_cardList1',
            response: {
                //res 即为原始返回的数据
                "statusCode": "1000", //解析接口状态

            },
            parseData: function(res) { //res 即为原始返回的数据

                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.data, //解析数据列表
                };
            },
            cols: [
                [{
                    title: '排名',
                    type: 'numbers'
                }, {
                    align: 'center',
                    field: 'agentName',
                    title: '服务商名称',
                }, {
                    align: 'center',
                    field: 'merchantCount',
                    title: '总商户数',
                }, {
                    align: 'center',
                    field: 'activeMerCount',
                    title: '活跃商户',
                }, {
                    align: 'center',
                    field: 'silenceMerCount',
                    title: '潜水商户',
                }]
            ],
            done: function(res, curr, count) {}
        });

        //服务商订单金额TOP10  
        function dingdanjin() {
            // ddDate = []
            // ddData = []
            for (let i = 0; i < shName1.length; i++) {
                shName1.splice(i)
            }
            for (let i = 0; i < shMoney1.length; i++) {
                shMoney1.splice(i)
            }
            CmsUtility.postAjaxCall(
                //系统设置
                CmsConfig.addressUrl.Mechanism.getInsAgentMoney, {
                    "institutionNumber": userNumber,
                    "page": 1,
                    "limit": 10
                },
                function(data) {

                    if (data.code == 1000) {
                        var res = data.data
                        //                shName = []
                        // shMoney = []
                        for (var j = 0; j < res.length; j++) {
                            shName2.push(res[j].Agent_Name)

                            shMoney2.push(res[j].orderMoney)
                        }
                        // 为echarts对象加载数据
                        myChart4.clear()
                        myChart4.setOption(option4, 'true');
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        dingdanjin()
       
        //服务商退款金额TOP10
        function tuikuanjin() {
            // ddDate = []
            // ddData = []
            for (let i = 0; i < shName1.length; i++) {
                shName1.splice(i)
            }
            for (let i = 0; i < shMoney1.length; i++) {
                shMoney1.splice(i)
            }
            CmsUtility.postAjaxCall(
                //系统设置
                'InsSPSS/getInsAgentRefundMoney', {
                    "institutionNumber": userNumber,
                    "page": 1,
                    "limit": 10
                },
                function(data) {

                    if (data.code == 1000) {
                        var res = data.data
                        //                shName = []
                        // shMoney = []
                        for (var j = 0; j < res.length; j++) {
                            shName1.push(res[j].Agent_Name)

                            shMoney1.push(res[j].refundMoney)
                        }
                        // 为echarts对象加载数据
                        myChart2.clear()
                        myChart2.setOption(option2, 'true');
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        tuikuanjin()
        function tuikuanbishu() {
            // ddDate = []
            // ddData = []
            for (let i = 0; i < shCount1.length; i++) {
                shCount1.splice(i)
            }
            CmsUtility.postAjaxCall(
                //系统设置
                'InsSPSS/getInsAgentRefundCount', {
                    "institutionNumber": userNumber,
                    "page": 1,
                    "limit": 10
                },
                function(data) {

                    if (data.code == 1000) {
                        var res = data.data
                        // shCount = []
                        for (var j = 0; j < res.length; j++) {
                            var newO = new Object()
                            newO.name = res[j].Agent_Name
                            newO.value = res[j].refundCount
                            shCount1.push(newO)

                        }
                        // 为echarts对象加载数据
                        myChart3.clear()
                        myChart3.setOption(option3, 'true');
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        tuikuanbishu()
        //服务商退款笔数TOP10
        
        //服务商订单笔数TOP10  
        function dingdanbishu() {
            // ddDate = []
            // ddData = []
            for (let i = 0; i < shCount2.length; i++) {
                shCount2.splice(i)
            }
            CmsUtility.postAjaxCall(
                //系统设置
                CmsConfig.addressUrl.Mechanism.getInsAgentCount, {
                    "institutionNumber": userNumber,
                    "page": 1,
                    "limit": 10
                },
                function(data) {

                    if (data.code == 1000) {
                        var res = data.data
                        // shCount = []
                        for (var j = 0; j < res.length; j++) {
                            var newO = new Object()
                            newO.name = res[j].Agent_Name
                            newO.value = res[j].orderCount
                            shCount2.push(newO)

                        }
                        // 为echarts对象加载数据
                        myChart5.clear()
                        myChart5.setOption(option5, 'true');
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        dingdanbishu()
        table.render({
            //url: serverUrl + 'memberCard/getAssociatorCards?userNumber=' + userNumber,
            url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Mechanism.getInsAgentCount + '?institutionNumber=' +
                userNumber,
            elem: '#members3',
            id: 'vip_cardList3',
            response: {
                //res 即为原始返回的数据
                "statusCode": "1000", //解析接口状态
            },
            parseData: function(res) { //res 即为原始返回的数据
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.data, //解析数据列表
                };
            },
            cols: [
                [{
                    title: '排名',
                    type: 'numbers'
                }, {
                    align: 'center',
                    field: 'Agent_Name',
                    title: '服务商名称',
                }, {
                    align: 'center',
                    field: 'orderCount',
                    title: '订单笔数',
                }]
            ],
            done: function(res, curr, count) {}
        });

        function butiejin() {
            // ddDate = []
            // ddData = []
            for (let i = 0; i < shName.length; i++) {
                shName.splice(i)
            }
            for (let i = 0; i < shMoney.length; i++) {
                shMoney.splice(i)
            }
            CmsUtility.postAjaxCall(
                //系统设置
                CmsConfig.addressUrl.Mechanism.getInsAgentSubMoney, {
                    "institutionNumber": userNumber,
                    "page": 1,
                    "limit": 10
                },
                function(data) {

                    if (data.code == 1000) {
                        var res = data.data
                        //                shName = []
                        // shMoney = []
                        for (var j = 0; j < res.length; j++) {
                            shName.push(res[j].Agent_Name)

                            shMoney.push(res[j].subsidyMoney)
                        }
                        // 为echarts对象加载数据
                        myChart.clear()
                        myChart.setOption(option, 'true');
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        butiejin()
       
        //补贴笔数TOP10
        function butiebishu() {
            // ddDate = []
            // ddData = []
            for (let i = 0; i < shCount.length; i++) {
                shCount.splice(i)
            }
            CmsUtility.postAjaxCall(
                //系统设置
                CmsConfig.addressUrl.Mechanism.getInsAgentSubCount, {
                    "institutionNumber": userNumber,
                    "page": 1,
                    "limit": 10
                },
                function(data) {

                    if (data.code == 1000) {
                        var res = data.data
                        // shCount = []
                        for (var j = 0; j < res.length; j++) {
                            var newO = new Object()
                            newO.name = res[j].Agent_Name
                            newO.value = res[j].subsidyCount
                            shCount.push(newO)

                        }
                        // 为echarts对象加载数据
                        myChart1.clear()
                        myChart1.setOption(option1, 'true');
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        butiebishu()
        table.render({
            //url: serverUrl + 'memberCard/getAssociatorCards?userNumber=' + userNumber,
            url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Mechanism.getInsAgentSubCount + '?institutionNumber=' +
                userNumber,
            elem: '#members5',
            id: 'vip_cardList5',
            response: {
                //res 即为原始返回的数据
                "statusCode": "1000", //解析接口状态
            },
            parseData: function(res) { //res 即为原始返回的数据
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.data, //解析数据列表
                };
            },
            cols: [
                [{
                    title: '序号',
                    type: 'numbers'
                }, {
                    align: 'center',
                    field: 'Agent_Name',
                    title: '服务商名称',
                }, {
                    align: 'center',
                    field: 'subsidyCount',
                    title: '补贴笔数',
                }]
            ],
            done: function(res, curr, count) {}
        });
    });

    function searchZhe() {
        // ddDate = []
        // ddData = []
        for (let i = 0; i < ddData.length; i++) {
            ddData.splice(i)
        }
        for (let i = 0; i < ddDate.length; i++) {
            ddDate.splice(i)
        }
        CmsUtility.postAjaxCall(
            //系统设置
            CmsConfig.addressUrl.Mechanism.orderAmountList, {
                "institutionNumber": userNumber,
                "startTime": $('#startTime').val(),
                "endTime": $('#endTime').val()
            },
            function(data) {
                if (data.code == 1000) {
                    var res = data.data.orderAmountList

                    for (var j = 0; j < res.length; j++) {
                        ddDate.push(res[j].date)
                        ddData.push(res[j].orderTotalMoney)
                    }
                    ddDate.sort()
                    // 为echarts对象加载数据
                    myChart.clear()
                    console.log(ddData, ddDate)
                    myChart.setOption(option, 'true');
                } else {
                    layer.msg(data.msg)
                }
            },
            function(data) {
                console.log('222')
            }
        )
    }
    // searchZhe()
    $('#searchZhe').click(function() {
        searchZhe()
        //  myChart.un("click", function () {
        //     alert("悲剧，你注销我了!");
        // });
    })
    </script>
</body>

</html>